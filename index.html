
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TINACOS PLASTINOVA - Sistema Profesional</title>

<!-- âœ… LIBRERÃAS CDN VERIFICADAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f4f8; color: #1a202c; }
.navbar { background: linear-gradient(135deg, #003f7f 0%, #1e3a8a 100%); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
.navbar-brand { font-size: 1.5rem; font-weight: bold; }
.navbar-right { display: flex; gap: 1rem; align-items: center; }
.carrito-icon { font-size: 1.5rem; cursor: pointer; position: relative; }
.carrito-contador { background: #dc2626; color: white; border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; position: absolute; top: -8px; right: -8px; }
.container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
.content { display: none; }
.content.active { display: block; }
.btn { background: #003f7f; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: 0.3s; }
.btn:hover { background: #1e3a8a; transform: translateY(-2px); }
.btn-secondary { background: #dc2626; }
.btn-secondary:hover { background: #991b1b; }
.btn-success { background: #10b981; }
.btn-success:hover { background: #059669; }
.btn-small { padding: 0.5rem 1rem; font-size: 0.9rem; }
.hero { background: white; border-radius: 16px; padding: 3rem 2rem; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.hero h1 { font-size: 2.5rem; margin-bottom: 1rem; color: #003f7f; }
.hero-eslogan { font-size: 1.2rem; color: #dc2626; font-weight: 700; margin-bottom: 1rem; }
.button-group { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; margin-top: 2rem; }
.form-group { margin-bottom: 1.5rem; }
.form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
.form-group input, .form-group select { width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; }
.form-group input:focus, .form-group select:focus { outline: none; border-color: #003f7f; }
.login-form { max-width: 450px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.form-title { font-size: 2rem; margin-bottom: 2rem; color: #003f7f; text-align: center; font-weight: 700; }
.dashboard { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.dashboard h2 { color: #003f7f; margin-bottom: 1.5rem; font-size: 1.8rem; font-weight: 700; }
.menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
.menu-item { background: linear-gradient(135deg, #003f7f 0%, #1e3a8a 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; border: none; font-size: 1rem; font-weight: 600; }
.menu-item:hover { transform: translateY(-4px); }
.grid-products { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; margin-top: 2rem; }
.product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: 0.3s; }
.product-card:hover { transform: translateY(-8px); box-shadow: 0 8px 16px rgba(0,0,0,0.15); }
.product-image { width: 100%; height: 180px; background: linear-gradient(135deg, #003f7f 0%, #dc2626 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 3.5rem; }
.product-info { padding: 1.5rem; }
.product-name { font-size: 1.2rem; font-weight: 700; color: #003f7f; margin-bottom: 0.5rem; }
.product-price { font-size: 1.6rem; color: #dc2626; font-weight: 900; margin-bottom: 1rem; }
.color-selector { margin-bottom: 1rem; }
.color-options { display: flex; flex-wrap: wrap; gap: 0.5rem; }
.color-btn { width: 35px; height: 35px; border-radius: 50%; border: 2px solid #e2e8f0; cursor: pointer; transition: 0.3s; }
.color-btn:hover { transform: scale(1.1); }
.color-btn.selected { border-color: #003f7f; border-width: 3px; }
.quantity-selector { display: flex; align-items: center; gap: 0.5rem; margin: 1rem 0; }
.quantity-btn { width: 32px; height: 32px; border: 2px solid #e2e8f0; background: white; cursor: pointer; border-radius: 6px; font-weight: bold; }
.quantity-input { width: 50px; text-align: center; border: 2px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; }
table { width: 100%; border-collapse: collapse; background: white; margin-top: 1rem; }
th { background: linear-gradient(135deg, #003f7f 0%, #1e3a8a 100%); color: white; padding: 1rem; text-align: left; font-weight: 600; }
td { padding: 1rem; border-bottom: 1px solid #e2e8f0; }
tr:hover { background: #f8fafc; }
.notification { position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 1rem 1.5rem; border-radius: 8px; z-index: 1000; animation: slideIn 0.3s; font-weight: 500; }
.notification.error { background: #dc2626; }
@keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }
.section-title { font-size: 1.6rem; color: #003f7f; margin-bottom: 1.5rem; font-weight: 700; border-left: 4px solid #dc2626; padding-left: 1rem; }
.modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); align-items: center; justify-content: center; }
.modal.active { display: flex; }
.modal-content { background: white; padding: 2rem; border-radius: 12px; max-width: 700px; width: 90%; max-height: 85vh; overflow-y: auto; }
.modal-header { font-size: 1.6rem; color: #003f7f; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; font-weight: 700; }
.modal-footer { display: flex; gap: 1rem; margin-top: 2rem; justify-content: flex-end; }
.stats-card { background: linear-gradient(135deg, #003f7f 0%, #1e3a8a 100%); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; }
.stats-card h3 { font-size: 1rem; margin-bottom: 0.5rem; opacity: 0.9; }
.stats-card p { font-size: 2rem; font-weight: 900; }
.footer { background: #003f7f; color: white; text-align: center; padding: 2rem 1rem; margin-top: 3rem; }
</style>
</head>
<body>

<nav class="navbar">
  <div class="navbar-brand">ğŸª TINACOS PLASTINOVA</div>
  <div class="navbar-right">
    <div id="navbar-user"></div>
    <div class="carrito-icon" onclick="abrirCarrito()" style="display:none" id="carrito-btn">
      ğŸ›’ <span class="carrito-contador" id="contador">0</span>
    </div>
  </div>
</nav>

<div id="landing" class="content active">
  <div class="container">
    <div class="hero">
      <h1>ğŸª TINACOS PLASTINOVA</h1>
      <div class="hero-eslogan">ğŸ’§ Soluciones Premium de Almacenamiento ğŸ’§</div>
      <p>Plataforma profesional de ventas de tinacos y tambores</p>
      <div class="button-group">
        <button class="btn" onclick="showLogin()">ğŸ” Iniciar SesiÃ³n</button>
        <button class="btn btn-secondary" onclick="showRegister()">ğŸ“‹ Registrarse</button>
        <button class="btn btn-success" onclick="guestCheckout()">ğŸ‘¤ Comprar como Invitado</button>
      </div>
    </div>
  </div>
</div>

<div id="register" class="content">
  <div class="container">
    <form class="login-form" onsubmit="handleRegister(event)">
      <h2 class="form-title">ğŸ“‹ Registro</h2>
      <div class="form-group"><label>Nombre:</label><input type="text" id="reg-nombre" required></div>
      <div class="form-group"><label>TelÃ©fono:</label><input type="tel" id="reg-telefono" required></div>
      <div class="form-group"><label>DirecciÃ³n:</label><input type="text" id="reg-direccion" required></div>
      <div class="form-group"><label>Usuario:</label><input type="text" id="reg-usuario" required></div>
      <div class="form-group"><label>ContraseÃ±a:</label><input type="password" id="reg-password" required></div>
      <div class="form-group">
        <label>Vendedor:</label>
        <select id="reg-vendedor" required>
          <option value="">Elegir vendedor...</option>
          <option>Husai M.</option>
          <option>Pedro D.</option>
          <option>Fernando O.</option>
          <option>Isidro G.</option>
        </select>
      </div>
      <div class="button-group">
        <button type="submit" class="btn btn-success">Registrarse</button>
        <button type="button" class="btn btn-secondary" onclick="backToLanding()">Volver</button>
      </div>
    </form>
  </div>
</div>

<div id="login" class="content">
  <div class="container">
    <form class="login-form" onsubmit="handleLogin(event)">
      <h2 class="form-title">ğŸ” Iniciar SesiÃ³n</h2>
      <div class="form-group"><label>Usuario:</label><input type="text" id="username" required></div>
      <div class="form-group"><label>ContraseÃ±a:</label><input type="password" id="password" required></div>
      <div class="button-group">
        <button type="submit" class="btn">Ingresar</button>
        <button type="button" class="btn btn-secondary" onclick="backToLanding()">Volver</button>
      </div>
    </form>
  </div>
</div>

<div id="comprador-dashboard" class="content">
  <div class="container">
    <div class="dashboard">
      <h2>ğŸ“¦ CatÃ¡logo de Productos</h2>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 2rem;">
        <button class="btn" onclick="mostrarCatalogo()">ğŸ“¦ CatÃ¡logo</button>
        <button class="btn" onclick="mostrarHistorial()">ğŸ“‹ Mis Pedidos</button>
        <button class="btn btn-secondary" onclick="logout()" style="margin-left: auto;">Cerrar SesiÃ³n</button>
      </div>
      <div class="grid-products" id="productos-grid"></div>
      <div id="historial-container" style="display: none;">
        <h3 class="section-title">ğŸ“‹ Mis Pedidos</h3>
        <table><thead><tr><th>Pedido</th><th>Total</th><th>Vendedor</th><th>Fecha</th></tr></thead><tbody id="historial-tabla"></tbody></table>
      </div>
    </div>
  </div>
</div>

<div id="carrito-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header"><span>ğŸ›’ Carrito</span><button class="btn btn-secondary btn-small" onclick="cerrarCarrito()">âœ•</button></div>
    <div id="carrito-items"></div>
    <div style="font-size: 1.3rem; font-weight: bold; margin: 1rem 0;" id="carrito-total">Total: $0</div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="cerrarCarrito()">Seguir Comprando</button>
      <button class="btn btn-success" onclick="abrirFormularioPedido()">ğŸ“¦ Continuar</button>
    </div>
  </div>
</div>

<div id="pedido-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header"><span>ğŸ“‹ Pedido</span><button class="btn btn-secondary btn-small" onclick="cerrarPedido()">âœ•</button></div>
    <form onsubmit="realizarPedido(event)">
      <div class="form-group"><label>Nombre:</label><input type="text" id="nombre-pedido" required></div>
      <div class="form-group"><label>DirecciÃ³n:</label><input type="text" id="direccion-pedido" required></div>
      <div class="form-group"><label>TelÃ©fono:</label><input type="tel" id="telefono-pedido" required></div>
      <div class="form-group">
        <label>Entrega:</label>
        <select id="tipo-entrega" required>
          <option value="domicilio">ğŸšš Domicilio</option>
          <option value="tienda">ğŸª Tienda</option>
        </select>
      </div>
      <div style="background: #f1f5f9; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem;">
          TOTAL: <span id="total-pedido">$0</span>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="cerrarPedido()">Cancelar</button>
        <button type="submit" class="btn btn-success">âœ… Realizar</button>
      </div>
    </form>
  </div>
</div>

<div id="vendedor-dashboard" class="content">
  <div class="container">
    <div class="dashboard">
      <h2>Panel de Vendedor</h2>
      <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
        <button class="btn btn-secondary" onclick="logout()" style="margin-left: auto;">Cerrar SesiÃ³n</button>
      </div>
      <div class="menu">
        <button class="menu-item" onclick="showVendedorSection('clientes')">ğŸ‘¥ Clientes</button>
        <button class="menu-item" onclick="showVendedorSection('agregar-cliente')">â• Agregar Cliente</button>
        <button class="menu-item" onclick="showVendedorSection('pedidos')">ğŸ“¦ Pedidos</button>
        <button class="menu-item" onclick="showVendedorSection('reportes')">ğŸ“ˆ Reportes</button>
      </div>
      <div id="vendedor-content"></div>
    </div>
  </div>
</div>

<div id="admin-dashboard" class="content">
  <div class="container">
    <div class="dashboard">
      <h2>Panel de Administrador</h2>
      <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
        <button class="btn btn-secondary" onclick="logout()" style="margin-left: auto;">Cerrar SesiÃ³n</button>
      </div>
      <div class="menu">
        <button class="menu-item" onclick="showAdminSection('productos')">ğŸ“¦ Productos</button>
        <button class="menu-item" onclick="showAdminSection('ventas')">ğŸ“Š Ventas</button>
        <button class="menu-item" onclick="showAdminSection('pedidos')">ğŸ“¦ Pedidos</button>
        <button class="menu-item" onclick="showAdminSection('clientes')">ğŸ‘¥ Clientes</button>
        <button class="menu-item" onclick="showAdminSection('reportes')">ğŸ“ˆ Reportes</button>
      </div>
      <div id="admin-content"></div>
    </div>
  </div>
</div>

<footer class="footer">
  <strong>TINACOS PLASTINOVA S.A. de C.V.</strong><br>
  ğŸ“ Carretera Zapata-Zacatepec, Col. LÃ¡zaro CÃ¡rdenas<br>
  ğŸ“ 777 5146927 / 777 5347617<br>
  Â© 2025 TINACOS PLASTINOVA
</footer>

<script>
// ========== DATOS ==========
const productos = [
  { id: 1, nombre: 'Tambo 235 lt', capacidad: 235, precio: 495, colores: { beige: '#D4A574', blanco: '#FFFFFF', negro: '#000000', azul: '#003B7F', rojo: '#DC2626' } },
  { id: 2, nombre: 'Tinaco 750 lt', capacidad: 750, precio: 1400, colores: { beige: '#D4A574', blanco: '#FFFFFF', negro: '#000000' } },
  { id: 3, nombre: 'Tinaco 1100 lt', capacidad: 1100, precio: 1250, colores: { beige: '#D4A574', blanco: '#FFFFFF', azul: '#003B7F' } },
  { id: 4, nombre: 'Tinaco 1200 lt', capacidad: 1200, precio: 1450, colores: { beige: '#D4A574', blanco: '#FFFFFF' } }
];

const vendedoresData = [
  { usuario: 'husai.mendez', password: 'Husai2024*', nombre: 'Husai M.', telefono: '777 5146927' },
  { usuario: 'pedro.delgado', password: 'Pedro2024*', nombre: 'Pedro D.', telefono: '777 5347617' },
  { usuario: 'fernando.ocampo', password: 'Fernando2024*', nombre: 'Fernando O.', telefono: '561 3420821' },
  { usuario: 'isidro.gonzalez', password: 'Isidro2024*', nombre: 'Isidro G.', telefono: '777 1636393' }
];

const admin = { usuario: 'admin.plastinova', password: 'Admin2024*Plastinova', nombre: 'Administrador' };

let usuarioActual = null, carrito = [], pedidos = [], usuariosRegistrados = [], clientesGlobal = [], ventas = [], colorSeleccionado = {};

// ========== NAVEGACIÃ“N ==========
function showContent(id) { document.querySelectorAll('.content').forEach(el => el.classList.remove('active')); document.getElementById(id).classList.add('active'); }
function backToLanding() { showContent('landing'); }
function showLogin() { showContent('login'); }
function showRegister() { showContent('register'); }

// ========== AUTENTICACIÃ“N ==========
function handleRegister(event) { 
  event.preventDefault(); 
  const nuevoCliente = { 
    usuario: document.getElementById('reg-usuario').value, 
    password: document.getElementById('reg-password').value, 
    nombre: document.getElementById('reg-nombre').value, 
    telefono: document.getElementById('reg-telefono').value, 
    direccion: document.getElementById('reg-direccion').value, 
    vendedor: document.getElementById('reg-vendedor').value, 
    rol: 'comprador' 
  }; 
  usuariosRegistrados.push(nuevoCliente); 
  clientesGlobal.push(nuevoCliente); 
  mostrarNotification('âœ… Registro exitoso'); 
  showContent('landing'); 
}

function guestCheckout() { 
  usuarioActual = { nombre: 'Invitado', rol: 'comprador', vendedor: 'N/A' }; 
  document.getElementById('carrito-btn').style.display = 'flex'; 
  updateNavbar(); 
  mostrarProductos(); 
}

function handleLogin(event) { 
  event.preventDefault(); 
  const username = document.getElementById('username').value; 
  const password = document.getElementById('password').value; 
  
  if (username === admin.usuario && password === admin.password) { 
    usuarioActual = {...admin, rol: 'admin'}; 
    updateNavbar(); 
    showContent('admin-dashboard'); 
    mostrarNotification('âœ… Bienvenido Administrador'); 
  } else { 
    const v = vendedoresData.find(v => v.usuario === username && v.password === password); 
    if (v) { 
      usuarioActual = {...v, rol: 'vendedor'}; 
      updateNavbar(); 
      showContent('vendedor-dashboard'); 
      mostrarNotification('âœ… Bienvenido ' + v.nombre); 
    } else { 
      const u = usuariosRegistrados.find(u => u.usuario === username && u.password === password); 
      if (u) { 
        usuarioActual = u; 
        updateNavbar(); 
        document.getElementById('carrito-btn').style.display = 'flex'; 
        mostrarProductos(); 
        mostrarNotification('âœ… Bienvenido ' + u.nombre); 
      } else { 
        mostrarNotification('âŒ Credenciales incorrectas', true); 
      } 
    } 
  } 
}

function logout() { 
  usuarioActual = null; 
  carrito = []; 
  showContent('landing'); 
  updateNavbar(); 
  document.getElementById('carrito-btn').style.display = 'none'; 
  mostrarNotification('ğŸ‘‹ SesiÃ³n cerrada'); 
}

function updateNavbar() { 
  document.getElementById('navbar-user').innerHTML = usuarioActual ? `<span>ğŸ‘¤ ${usuarioActual.nombre}</span>` : ''; 
}

// ========== CATÃLOGO ==========
function mostrarCatalogo() { 
  document.getElementById('productos-grid').style.display = 'grid'; 
  document.getElementById('historial-container').style.display = 'none'; 
}

function mostrarHistorial() { 
  document.getElementById('productos-grid').style.display = 'none'; 
  document.getElementById('historial-container').style.display = 'block'; 
  
  const pedidosUsuario = pedidos.filter(p => p.usuario === (usuarioActual?.usuario || 'invitado'));
  document.getElementById('historial-tabla').innerHTML = pedidosUsuario.length === 0 
    ? '<tr><td colspan="4">No hay pedidos</td></tr>' 
    : pedidosUsuario.map(p => `<tr><td>${p.numero}</td><td>$${p.total.toFixed(2)}</td><td>${p.vendedor}</td><td>${p.fecha}</td></tr>`).join(''); 
}

function mostrarProductos() { 
  const grid = document.getElementById('productos-grid'); 
  grid.innerHTML = productos.map(p => `
    <div class="product-card">
      <div class="product-image">ğŸ’§</div>
      <div class="product-info">
        <div class="product-name">${p.nombre}</div>
        <div class="product-price">$${p.precio.toFixed(2)}</div>
        <div class="color-selector">
          <div style="font-size: 0.9rem; margin-bottom: 0.5rem; font-weight: 600;">Color:</div>
          <div class="color-options" id="colores-${p.id}">
            ${Object.entries(p.colores).map(([nombre, hex]) => 
              `<button type="button" class="color-btn" style="background-color: ${hex};" onclick="selectColor(${p.id}, '${nombre}')" id="color-${p.id}-${nombre}"></button>`
            ).join('')}
          </div>
        </div>
        <div class="quantity-selector">
          <button type="button" class="quantity-btn" onclick="cambiarCantidad(${p.id}, -1)">âˆ’</button>
          <input type="number" class="quantity-input" id="qty-${p.id}" value="1" min="1">
          <button type="button" class="quantity-btn" onclick="cambiarCantidad(${p.id}, 1)">+</button>
        </div>
        <button type="button" class="btn btn-success" style="width: 100%;" onclick="agregarAlCarrito(${p.id})">â• Agregar</button>
      </div>
    </div>
  `).join(''); 
  showContent('comprador-dashboard'); 
}

function selectColor(productId, colorNombre) { 
  colorSeleccionado[productId] = colorNombre; 
  document.querySelectorAll(`#colores-${productId} .color-btn`).forEach(btn => btn.classList.remove('selected')); 
  document.getElementById(`color-${productId}-${colorNombre}`).classList.add('selected'); 
}

function cambiarCantidad(productId, delta) { 
  const input = document.getElementById(`qty-${productId}`); 
  input.value = Math.max(1, parseInt(input.value) + delta); 
}

function agregarAlCarrito(productId) { 
  const producto = productos.find(p => p.id === productId); 
  const cantidad = parseInt(document.getElementById(`qty-${productId}`).value); 
  const color = (colorSeleccionado[productId] || 'BLANCO').toUpperCase(); 
  
  carrito.push({ 
    producto: producto.nombre.toUpperCase(), 
    precio: producto.precio, 
    cantidad, 
    color, 
    subtotal: producto.precio * cantidad 
  }); 
  
  document.getElementById('contador').textContent = carrito.length; 
  mostrarNotification(`âœ… Agregado: ${cantidad}x ${producto.nombre}`); 
}

// ========== CARRITO ==========
function abrirCarrito() { 
  document.getElementById('carrito-items').innerHTML = carrito.length === 0 
    ? '<p>Carrito vacÃ­o</p>' 
    : `<table><thead><tr><th>Producto</th><th>Color</th><th>Cant</th><th>Precio</th><th></th></tr></thead><tbody>${carrito.map((item, idx) => `<tr><td>${item.producto}</td><td>${item.color}</td><td>${item.cantidad}</td><td>$${item.subtotal.toFixed(2)}</td><td><button class="btn btn-secondary btn-small" onclick="carrito.splice(${idx}, 1); abrirCarrito(); document.getElementById('contador').textContent = carrito.length;">âŒ</button></td></tr>`).join('')}</tbody></table>`; 
  
  const total = carrito.reduce((s, item) => s + item.subtotal, 0); 
  document.getElementById('carrito-total').innerHTML = `Total: $${total.toFixed(2)}`; 
  document.getElementById('carrito-modal').classList.add('active'); 
}

function cerrarCarrito() { document.getElementById('carrito-modal').classList.remove('active'); }

// ========== PEDIDO ==========
function abrirFormularioPedido() { 
  if (carrito.length === 0) { mostrarNotification('âŒ Carrito vacÃ­o', true); return; }
  cerrarCarrito(); 
  const total = carrito.reduce((s, item) => s + item.subtotal, 0); 
  document.getElementById('total-pedido').innerHTML = `$${total.toFixed(2)}`; 
  document.getElementById('pedido-modal').classList.add('active'); 
}

function cerrarPedido() { document.getElementById('pedido-modal').classList.remove('active'); }

function realizarPedido(event) { 
  event.preventDefault(); 
  if (carrito.length === 0) return; 
  
  const nombre = document.getElementById('nombre-pedido').value; 
  const direccion = document.getElementById('direccion-pedido').value; 
  const telefono = document.getElementById('telefono-pedido').value; 
  const tipoEntrega = document.getElementById('tipo-entrega').value; 
  const total = carrito.reduce((s, item) => s + item.subtotal, 0); 
  const numeroPedido = '#' + Math.random().toString(36).substr(2, 9).toUpperCase(); 
  
  const vendedorAleatorio = usuarioActual?.vendedor && usuarioActual.vendedor !== 'N/A'
    ? vendedoresData.find(v => v.nombre === usuarioActual.vendedor) || vendedoresData[0]
    : vendedoresData[Math.floor(Math.random() * vendedoresData.length)];
  
  const fechaActual = new Date().toLocaleDateString('es-MX', { day: '2-digit', month: '2-digit', year: 'numeric' });
  
  const pedido = { 
    numero: numeroPedido, 
    nombre, 
    direccion, 
    telefono, 
    tipoEntrega, 
    items: [...carrito], 
    total, 
    fecha: fechaActual, 
    vendedor: vendedorAleatorio.nombre,
    usuario: usuarioActual?.usuario || 'invitado',
    metodoPago: 'Efectivo'
  }; 
  
  pedidos.push(pedido); 
  ventas.push({ 
    vendedor: vendedorAleatorio.nombre, 
    cliente: nombre, 
    total, 
    fecha: fechaActual, 
    items: [...carrito] 
  }); 
  
  mostrarNotification(`âœ… Pedido ${numeroPedido} realizado`); 
  carrito = []; 
  document.getElementById('contador').textContent = 0; 
  cerrarPedido(); 
  mostrarProductos(); 
}

// ========== VENDEDOR ==========
function showVendedorSection(section) { 
  const content = document.getElementById('vendedor-content'); 
  const misClientes = clientesGlobal.filter(c => c.vendedor === usuarioActual.nombre); 
  
  if (section === 'clientes') { 
    content.innerHTML = `<h3 class="section-title">ğŸ‘¥ Clientes</h3>${misClientes.length === 0 ? '<p>No hay clientes</p>' : `<table><thead><tr><th>Nombre</th><th>TelÃ©fono</th><th>DirecciÃ³n</th></tr></thead><tbody>${misClientes.map(c => `<tr><td>${c.nombre}</td><td>${c.telefono}</td><td>${c.direccion}</td></tr>`).join('')}</tbody></table>`}`; 
  } else if (section === 'agregar-cliente') { 
    content.innerHTML = `<h3 class="section-title">â• Agregar Cliente</h3><form onsubmit="agregarClienteVendedor(event)"><div class="form-group"><label>Nombre:</label><input type="text" id="nombre-cliente-v" required></div><div class="form-group"><label>TelÃ©fono:</label><input type="tel" id="tel-cliente-v" required></div><div class="form-group"><label>DirecciÃ³n:</label><input type="text" id="dir-cliente-v" required></div><button type="submit" class="btn btn-success">Agregar</button></form>`; 
  } else if (section === 'pedidos') { 
    const misPedidos = pedidos.filter(p => p.vendedor === usuarioActual.nombre); 
    content.innerHTML = `<h3 class="section-title">ğŸ“¦ Pedidos</h3>${misPedidos.length === 0 ? '<p>No hay pedidos</p>' : `<table><thead><tr><th>Pedido</th><th>Cliente</th><th>Total</th><th>Fecha</th></tr></thead><tbody>${misPedidos.map(p => `<tr><td>${p.numero}</td><td>${p.nombre}</td><td>$${p.total.toFixed(2)}</td><td>${p.fecha}</td></tr>`).join('')}</tbody></table>`}`; 
  } else if (section === 'reportes') {
    const misVentas = ventas.filter(v => v.vendedor === usuarioActual.nombre);
    const totalVentas = misVentas.reduce((sum, v) => sum + v.total, 0);
    
    content.innerHTML = `
      <h3 class="section-title">ğŸ“ˆ Reportes</h3>
      <div class="stats-card"><h3>Total Ventas</h3><p>$${totalVentas.toFixed(2)}</p></div>
      <div style="margin-top: 2rem;">
        <button class="btn" onclick="descargarReportePDF()">ğŸ“„ PDF</button>
        <button class="btn btn-secondary" onclick="descargarReporteExcel()" style="margin-left: 1rem;">ğŸ“Š Excel</button>
      </div>
    `;
  }
}

function agregarClienteVendedor(event) { 
  event.preventDefault(); 
  const nombre = document.getElementById('nombre-cliente-v').value; 
  const telefono = document.getElementById('tel-cliente-v').value; 
  const direccion = document.getElementById('dir-cliente-v').value; 
  clientesGlobal.push({ nombre, telefono, direccion, vendedor: usuarioActual.nombre }); 
  mostrarNotification('âœ… Cliente agregado'); 
  showVendedorSection('clientes'); 
}

// ========== ADMIN ==========
function showAdminSection(section) { 
  const content = document.getElementById('admin-content'); 
  
  if (section === 'productos') { 
    content.innerHTML = `<h3 class="section-title">ğŸ“¦ Productos</h3><table><thead><tr><th>Producto</th><th>Precio</th></tr></thead><tbody>${productos.map(p => `<tr><td>${p.nombre}</td><td>$${p.precio.toFixed(2)}</td></tr>`).join('')}</tbody></table>`; 
  } else if (section === 'ventas') { 
    content.innerHTML = `<h3 class="section-title">ğŸ“Š Ventas</h3>${ventas.length === 0 ? '<p>No hay ventas</p>' : `<table><thead><tr><th>Vendedor</th><th>Cliente</th><th>Total</th><th>Fecha</th></tr></thead><tbody>${ventas.map(v => `<tr><td>${v.vendedor}</td><td>${v.cliente}</td><td>$${v.total.toFixed(2)}</td><td>${v.fecha}</td></tr>`).join('')}</tbody></table>`}`; 
  } else if (section === 'pedidos') { 
    content.innerHTML = `<h3 class="section-title">ğŸ“¦ Pedidos</h3>${pedidos.length === 0 ? '<p>No hay pedidos</p>' : `<table><thead><tr><th>Pedido</th><th>Cliente</th><th>Vendedor</th><th>Total</th></tr></thead><tbody>${pedidos.map(p => `<tr><td>${p.numero}</td><td>${p.nombre}</td><td>${p.vendedor}</td><td>$${p.total.toFixed(2)}</td></tr>`).join('')}</tbody></table>`}`; 
  } else if (section === 'clientes') { 
    content.innerHTML = `<h3 class="section-title">ğŸ‘¥ Clientes</h3>${clientesGlobal.length === 0 ? '<p>No hay clientes</p>' : `<table><thead><tr><th>Nombre</th><th>TelÃ©fono</th><th>Vendedor</th></tr></thead><tbody>${clientesGlobal.map(c => `<tr><td>${c.nombre}</td><td>${c.telefono}</td><td>${c.vendedor}</td></tr>`).join('')}</tbody></table>`}`; 
  } else if (section === 'reportes') { 
    const totalVentas = ventas.reduce((s, v) => s + v.total, 0); 
    content.innerHTML = `
      <h3 class="section-title">ğŸ“ˆ Reportes</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div class="stats-card"><h3>Total Ventas</h3><p>$${totalVentas.toFixed(2)}</p></div>
        <div class="stats-card" style="background: #dc2626;"><h3>Pedidos</h3><p>${pedidos.length}</p></div>
        <div class="stats-card" style="background: #10b981;"><h3>Clientes</h3><p>${clientesGlobal.length}</p></div>
      </div>
      <div style="margin-top: 2rem;">
        <button class="btn" onclick="descargarReportePDF()">ğŸ“„ Descargar PDF</button>
        <button class="btn btn-secondary" onclick="descargarReporteExcel()" style="margin-left: 1rem;">ğŸ“Š Descargar Excel</button>
      </div>
    `; 
  } 
}

// ========== EXPORTAR PDF (FUNCIONA 100%) ==========
function descargarReportePDF() {
  // Verificar librerÃ­a
  if (typeof window.jspdf === 'undefined') {
    alert('âš ï¸ ERROR: La librerÃ­a jsPDF no se cargÃ³ correctamente.\n\nPor favor:\n1. Verifica tu conexiÃ³n a internet\n2. Recarga la pÃ¡gina (F5)\n3. Intenta de nuevo');
    return;
  }

  try {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    let y = 20;
    
    // ENCABEZADO
    doc.setFontSize(18);
    doc.setFont('helvetica', 'bold');
    doc.text('TINACOS PLASTINOVA S.A. de C.V.', 105, y, { align: 'center' });
    y += 10;
    
    doc.setFontSize(14);
    doc.text('REPORTE DE VENTAS', 105, y, { align: 'center' });
    y += 15;
    
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    doc.text(`Fecha: ${new Date().toLocaleDateString('es-MX')}`, 14, y);
    y += 10;
    
    // RESUMEN
    const totalVentas = ventas.reduce((sum, v) => sum + v.total, 0);
    doc.setFont('helvetica', 'bold');
    doc.text('RESUMEN:', 14, y);
    y += 7;
    doc.setFont('helvetica', 'normal');
    doc.text(`Total Ventas: ${ventas.length}`, 14, y);
    y += 6;
    doc.text(`Total Pedidos: ${pedidos.length}`, 14, y);
    y += 6;
    doc.text(`Monto Total: $${totalVentas.toFixed(2)}`, 14, y);
    y += 12;
    
    // DETALLE DE PEDIDOS
    doc.setFont('helvetica', 'bold');
    doc.text('DETALLE DE PEDIDOS:', 14, y);
    y += 8;
    
    pedidos.forEach((pedido, index) => {
      if (y > 260) {
        doc.addPage();
        y = 20;
      }
      
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.text(`Pedido: ${pedido.numero}`, 14, y);
      y += 6;
      
      doc.setFont('helvetica', 'normal');
      doc.setFontSize(9);
      doc.text(`Cliente: ${pedido.nombre}`, 14, y);
      y += 5;
      doc.text(`Vendedor: ${pedido.vendedor}`, 14, y);
      y += 5;
      doc.text(`Total: $${pedido.total.toFixed(2)}`, 14, y);
      y += 5;
      doc.text(`MÃ©todo Pago: ${pedido.metodoPago || 'Efectivo'}`, 14, y);
      y += 5;
      doc.text(`Fecha: ${pedido.fecha}`, 14, y);
      y += 10;
      
      if (index < pedidos.length - 1) {
        doc.line(14, y - 2, 196, y - 2);
      }
    });
    
    // Guardar PDF
    doc.save(`Reporte_Plastinova_${new Date().toLocaleDateString('es-MX').replace(/\//g, '-')}.pdf`);
    mostrarNotification('âœ… PDF descargado correctamente');
    
  } catch (error) {
    alert('âŒ Error al generar PDF: ' + error.message);
    console.error(error);
  }
}

// ========== EXPORTAR EXCEL (FORMATO CORRECTO 100%) ==========
function descargarReporteExcel() {
  // Verificar librerÃ­a
  if (typeof XLSX === 'undefined') {
    alert('âš ï¸ ERROR: La librerÃ­a XLSX no se cargÃ³ correctamente.\n\nPor favor:\n1. Verifica tu conexiÃ³n a internet\n2. Recarga la pÃ¡gina (F5)\n3. Intenta de nuevo');
    return;
  }

  try {
    // Crear datos con formato EXACTO de la imagen
    const data = [];
    
    // Fila 1: TÃ­tulo
    data.push(['CONTROL DE VENTAS PLASTINOVA']);
    data.push([]); // Fila vacÃ­a
    
    // Fila 3: Encabezados (EXACTOS como en tu imagen)
    data.push(['10/10/25', 'VENDEDOR', 'DESCRIPCION', 'CANT.', 'PRECIO UNI', 'SUBTOTAL']);
    
    // Agregar datos de pedidos
    pedidos.forEach(pedido => {
      if (pedido.items && pedido.items.length > 0) {
        pedido.items.forEach(item => {
          data.push([
            pedido.fecha,                    // Fecha
            pedido.vendedor,                 // ISIDRO
            item.producto + ' ' + (item.color || '').toUpperCase(),  // TINACO 1100 LT AZUL
            item.cantidad,                   // 1.00
            '$' + item.precio.toFixed(2),   // $1,250.00
            '$' + item.subtotal.toFixed(2)  // $1,250.00
          ]);
        });
      }
    });
    
    // Crear workbook
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(data);
    
    // Configurar anchos de columna
    ws['!cols'] = [
      { wch: 12 },  // Fecha
      { wch: 20 },  // Vendedor
      { wch: 35 },  // DescripciÃ³n
      { wch: 8 },   // Cantidad
      { wch: 13 },  // Precio Uni
      { wch: 13 }   // Subtotal
    ];
    
    // Combinar celdas del tÃ­tulo
    ws['!merges'] = [{ s: { r: 0, c: 0 }, e: { r: 0, c: 5 } }];
    
    // Agregar hoja al libro
    XLSX.utils.book_append_sheet(wb, ws, 'Ventas');
    
    // Descargar archivo
    XLSX.writeFile(wb, `Control_Ventas_Plastinova_${new Date().toLocaleDateString('es-MX').replace(/\//g, '-')}.xlsx`);
    
    mostrarNotification('âœ… Excel descargado correctamente');
    
  } catch (error) {
    alert('âŒ Error al generar Excel: ' + error.message);
    console.error(error);
  }
}

// ========== NOTIFICACIONES ==========
function mostrarNotification(msg, esError = false) { 
  const n = document.createElement('div'); 
  n.className = 'notification' + (esError ? ' error' : ''); 
  n.textContent = msg; 
  document.body.appendChild(n); 
  setTimeout(() => n.remove(), 3000); 
}

// Verificar carga de librerÃ­as al iniciar
window.addEventListener('load', () => {
  console.log('âœ… Sistema iniciado');
  console.log('jsPDF cargado:', typeof window.jspdf !== 'undefined' ? 'SÃ' : 'NO');
  console.log('XLSX cargado:', typeof XLSX !== 'undefined' ? 'SÃ' : 'NO');
  
  if (typeof window.jspdf === 'undefined' || typeof XLSX === 'undefined') {
    alert('âš ï¸ ADVERTENCIA: Algunas librerÃ­as no se cargaron.\n\nAsegÃºrate de tener conexiÃ³n a internet y recarga la pÃ¡gina.');
  }
});
</script>
</body>
</html>

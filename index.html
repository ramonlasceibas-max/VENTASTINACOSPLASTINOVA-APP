
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#003f7f">
    <link rel="manifest" href="manifest.json">
    <title>üè™ TINACOS PLASTINOVA - Sistema Completo</title>
    
    <!-- LIBRER√çAS PARA PDF Y EXCEL -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; color: #1e293b; min-height: 100vh; display: flex; flex-direction: column; }
        .navbar { background: linear-gradient(135deg, #003f7f 0%, #1e3a8a 100%); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .navbar-brand { display: flex; align-items: center; gap: 1rem; font-size: 1.5rem; font-weight: bold; }
        .navbar-logo { width: 50px; height: 50px; border-radius: 8px; background: white; padding: 3px; object-fit: contain; }
        .navbar-right { display: flex; gap: 1rem; align-items: center; }
        .carrito-icon { font-size: 1.5rem; cursor: pointer; }
        .carrito-contador { background: #dc2626; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; flex: 1; }
        .content { display: none; }
        .content.active { display: block; }
        .btn { background: #003f7f; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn:hover { background: #1e3a8a; transform: translateY(-2px); }
        .btn-secondary { background: #dc2626; }
        .btn-secondary:hover { background: #991b1b; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-warning { background: #f59e0b; }
        .btn-warning:hover { background: #d97706; }
        .btn-danger { background: #dc2626; }
        .btn-danger:hover { background: #991b1b; }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.9rem; }
        .logout-btn { background: #dc2626; }
        .hero { background: white; border-radius: 16px; padding: 4rem 2rem; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .hero h1 { font-size: 3rem; margin-bottom: 1rem; color: #003f7f; font-weight: 900; letter-spacing: 1px; }
        .hero-eslogan { font-size: 1.25rem; color: #dc2626; font-weight: 700; margin-bottom: 1rem; }
        .hero p { font-size: 1.1rem; color: #64748b; margin-bottom: 2rem; }
        .button-group { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; margin-top: 2rem; }
        .button-group .btn { flex: 1; min-width: 180px; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #003f7f; }
        .form-group input[type="checkbox"] { width: auto; }
        .login-form { max-width: 400px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .form-title { font-size: 2rem; margin-bottom: 2rem; color: #003f7f; }
        .dashboard { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .dashboard h2 { color: #003f7f; margin-bottom: 1.5rem; }
        .menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .menu-item { background: linear-gradient(135deg, #003f7f 0%, #1e3a8a 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; border: none; font-size: 1rem; font-weight: 500; }
        .menu-item:hover { transform: translateY(-4px); }
        .menu-item.produccion { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .grid-products { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: 0.3s; border: 2px solid transparent; }
        .product-card:hover { transform: translateY(-8px); border-color: #003f7f; }
        .product-image { width: 100%; height: 200px; background: linear-gradient(135deg, #003f7f 0%, #dc2626 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; object-fit: cover; }
        .product-info { padding: 1.5rem; }
        .product-name { font-size: 1.25rem; font-weight: 600; color: #003f7f; margin-bottom: 0.5rem; }
        .product-capacity { font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem; }
        .product-price { font-size: 1.75rem; color: #dc2626; font-weight: bold; margin-bottom: 1rem; }
        .color-selector { margin-bottom: 1rem; }
        .color-label { font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem; }
        .color-options { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.5rem; }
        .color-btn { width: 35px; height: 35px; border-radius: 50%; border: 2px solid #e2e8f0; cursor: pointer; transition: 0.3s; }
        .color-btn:hover { transform: scale(1.1); }
        .color-btn.selected { border-color: #003f7f; border-width: 3px; }
        .quantity-selector { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
        .quantity-btn { width: 32px; height: 32px; border: 1px solid #e2e8f0; background: white; border-radius: 4px; cursor: pointer; }
        .quantity-input { width: 50px; text-align: center; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 4px; }
        .table-container { overflow-x: auto; margin-top: 2rem; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        th { background: linear-gradient(135deg, #003f7f 0%, #1e3a8a 100%); color: white; padding: 1rem; text-align: left; font-weight: 600; }
        td { padding: 1rem; border-bottom: 1px solid #e2e8f0; }
        tr:hover { background: #f8fafc; }
        .notification { position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: slideIn 0.3s ease; z-index: 1000; }
        .notification.error { background: #dc2626; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .section-title { font-size: 1.75rem; color: #003f7f; margin-bottom: 1.5rem; }
        .info-box { background: #f1f5f9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #003f7f; }
        .info-box.warning { border-left-color: #f59e0b; background: #fffbeb; }
        .info-box.success { border-left-color: #10b981; background: #f0fdf4; }
        .info-box.danger { border-left-color: #dc2626; background: #fef2f2; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); align-items: center; justify-content: center; overflow-y: auto; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); margin: auto; }
        .modal-header { font-size: 1.75rem; color: #003f7f; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #64748b; }
        .modal-footer { display: flex; gap: 1rem; margin-top: 2rem; justify-content: flex-end; flex-wrap: wrap; }
        .dos-columnas { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .tres-columnas { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; }
        .precio-box { background: #f1f5f9; padding: 1.5rem; border-radius: 8px; margin: 1rem 0; }
        .precio-fila { display: flex; justify-content: space-between; margin: 0.75rem 0; font-size: 1.1rem; }
        .precio-total { font-size: 1.5rem; font-weight: bold; color: #003f7f; border-top: 2px solid #e2e8f0; padding-top: 1rem; margin-top: 1rem; }
        .info-campo { background: #f1f5f9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .info-campo strong { color: #003f7f; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: linear-gradient(135deg, #003f7f 0%, #1e3a8a 100%); color: white; padding: 1.5rem; border-radius: 12px; }
        .stat-card.warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .stat-card.success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .stat-card.danger { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); }
        .stat-card h3 { font-size: 0.9rem; margin-bottom: 0.5rem; opacity: 0.9; }
        .stat-card p { font-size: 2rem; font-weight: 900; }
        .footer { background: #003f7f; color: white; text-align: center; padding: 2rem 1rem; margin-top: auto; }
        .footer strong { font-size: 1.2rem; }
        .footer a { color: white; text-decoration: underline; }
        .footer-section { margin: 0.8rem 0; }
        .delete-actions { display: flex; gap: 1rem; flex-wrap: wrap; margin: 1rem 0; padding: 1rem; background: #fef2f2; border-radius: 8px; border: 2px solid #dc2626; }
        @media (max-width: 768px) { .navbar { flex-direction: column; gap: 1rem; } .hero h1 { font-size: 2rem; } .button-group { flex-direction: column; } .button-group .btn { width: 100%; } .grid-products { grid-template-columns: 1fr; } .dos-columnas, .tres-columnas { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">
            <img src="logo-tinacos.jpg" alt="Logo" class="navbar-logo" onerror="this.style.display='none'">
            <span>üè™ TINACOS PLASTINOVA</span>
        </div>
        <div class="navbar-right">
            <div id="navbar-user"></div>
            <div class="carrito-icon" onclick="abrirCarrito()" style="display:none" id="carrito-btn">
                üõí <span class="carrito-contador" id="contador">0</span>
            </div>
        </div>
    </nav>

    <!-- LANDING -->
    <div id="landing" class="content active">
        <div class="container">
            <div class="hero">
                <h1>üè™ TINACOS PLASTINOVA</h1>
                <div class="hero-eslogan">üíß Soluciones Premium de Almacenamiento üíß</div>
                <p>Plataforma profesional de ventas y producci√≥n de tinacos de excelencia</p>
                <div class="button-group">
                    <button class="btn" onclick="showLogin()">üîê Iniciar Sesi√≥n</button>
                    <button class="btn btn-secondary" onclick="showRegister()">üìã Registrarse</button>
                    <button class="btn btn-success" onclick="guestCheckout()">üë§ Comprar como Invitado</button>
                </div>
            </div>
        </div>
    </div>

    <!-- REGISTRO -->
    <div id="register" class="content">
        <div class="container">
            <form class="login-form" onsubmit="handleRegister(event)">
                <h2 class="form-title">Registrarse</h2>
                <div class="form-group"><label>Nombre:</label><input type="text" id="reg-nombre" required></div>
                <div class="form-group"><label>Tel√©fono:</label><input type="tel" id="reg-telefono" required></div>
                <div class="form-group"><label>Direcci√≥n:</label><input type="text" id="reg-direccion" required></div>
                <div class="form-group"><label>Usuario:</label><input type="text" id="reg-usuario" required></div>
                <div class="form-group"><label>Contrase√±a:</label><input type="password" id="reg-password" required></div>
                <div class="form-group">
                    <label>Vendedor:</label>
                    <select id="reg-vendedor" required>
                        <option value="">Elegir vendedor...</option>
                        <option>Husai M.</option>
                        <option>Pedro D.</option>
                        <option>Fernando O.</option>
                        <option>Isidro G.</option>
                    </select>
                </div>
                <div class="button-group">
                    <button type="submit" class="btn">Registrarse</button>
                    <button type="button" class="btn btn-secondary" onclick="backToLanding()">Volver</button>
                </div>
            </form>
        </div>
    </div>

    <!-- LOGIN -->
    <div id="login" class="content">
        <div class="container">
            <form class="login-form" onsubmit="handleLogin(event)">
                <h2 class="form-title">Iniciar Sesi√≥n</h2>
                <div class="form-group"><label>Usuario:</label><input type="text" id="username" required></div>
                <div class="form-group"><label>Contrase√±a:</label><input type="password" id="password" required></div>
                <div class="form-group"><label><input type="checkbox" id="recordar-usuario"> Recordar usuario</label></div>
                <div class="button-group">
                    <button type="submit" class="btn">Ingresar</button>
                    <button type="button" class="btn btn-secondary" onclick="backToLanding()">Volver</button>
                </div>
            </form>
        </div>
    </div>

    <!-- DASHBOARD COMPRADOR -->
    <div id="comprador-dashboard" class="content">
        <div class="container">
            <div class="dashboard">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <h2 id="titulo-cliente">Cat√°logo de Productos</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="mostrarCatalogo()">üì¶ Cat√°logo</button>
                        <button class="btn" onclick="mostrarHistorial()">üìã Mis Pedidos</button>
                        <button class="btn" onclick="mostrarNotasCliente()">üìÑ Mis Notas/Facturas</button>
                        <button class="btn" onclick="abrirCambiarPassword()">üîê Cambiar Contrase√±a</button>
                        <button class="btn logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
                    </div>
                </div>
                <div class="grid-products" id="productos-grid"></div>
                <div id="historial-container" style="display: none; margin-top: 2rem;">
                    <h3 class="section-title">üìã Mis Pedidos</h3>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>Pedido</th><th>Total</th><th>Tipo Entrega</th><th>Vendedor | Tel√©fono</th><th>Fecha</th></tr></thead>
                            <tbody id="historial-tabla"></tbody>
                        </table>
                    </div>
                </div>
                <div id="notas-container" style="display: none; margin-top: 2rem;">
                    <h3 class="section-title">üìÑ Mis Notas y Facturas</h3>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>Tipo</th><th>N√∫mero</th><th>Pedido</th><th>Total</th><th>Fecha</th></tr></thead>
                            <tbody id="notas-tabla"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALES (Cambiar password, Carrito, Pedidos) -->
    <div id="cambiar-password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span>üîê Cambiar Contrase√±a</span><button class="modal-close" onclick="cerrarCambiarPassword()">‚úï</button></div>
            <form onsubmit="cambiarPassword(event)">
                <div class="form-group"><label>Contrase√±a Actual:</label><input type="password" id="pass-actual" required></div>
                <div class="form-group"><label>Nueva Contrase√±a:</label><input type="password" id="pass-nueva" required></div>
                <div class="form-group"><label>Confirmar:</label><input type="password" id="pass-confirmar" required></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarCambiarPassword()">Cancelar</button>
                    <button type="submit" class="btn btn-success">Cambiar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="carrito-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span>üõí Tu Carrito</span><button class="modal-close" onclick="cerrarCarrito()">‚úï</button></div>
            <div id="carrito-items"></div>
            <div class="carrito-total" id="carrito-total">Total: $0</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarCarrito()">Seguir Comprando</button>
                <button class="btn btn-success" onclick="abrirFormularioPedido()">üì¶ Continuar</button>
            </div>
        </div>
    </div>

    <div id="pedido-cliente-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span>üìã Confirmar Pedido</span><button class="modal-close" onclick="cerrarPedidoCliente()">‚úï</button></div>
            <form onsubmit="realizarPedidoCliente(event)">
                <div class="info-campo"><strong>Nombre:</strong> <span id="nombre-mostrar"></span></div>
                <div class="info-campo"><strong>Direcci√≥n:</strong> <span id="direccion-mostrar"></span></div>
                <div class="info-campo"><strong>Tel√©fono:</strong> <span id="telefono-mostrar"></span></div>
                <div class="form-group">
                    <label>Tipo de Entrega:</label>
                    <select id="tipo-entrega-cliente" required>
                        <option value="">Seleccionar...</option>
                        <option value="tienda">üè™ Recoger en Tienda</option>
                        <option value="domicilio">üöö Recibir en Domicilio</option>
                        <option value="local">üì¶ Recibir en Local/Negocio</option>
                    </select>
                </div>
                <div class="form-group"><label>Qui√©n Recibir√°:</label><input type="text" id="quien-recibe" placeholder="Nombre de la persona" required></div>
                <div class="form-group">
                    <label>M√©todo de Pago:</label>
                    <select id="metodo-pago" required>
                        <option value="">Seleccionar...</option>
                        <option value="efectivo">üíµ Efectivo</option>
                        <option value="transferencia">üí≥ Transferencia</option>
                    </select>
                </div>
                <div class="precio-box">
                    <div class="precio-fila"><span>Subtotal:</span><span id="subtotal-cliente">$0</span></div>
                    <div class="precio-fila precio-total"><span>TOTAL:</span><span id="total-cliente">$0</span></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarPedidoCliente()">Cancelar</button>
                    <button type="submit" class="btn btn-success">‚úÖ Confirmar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="pedido-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span>üìã Informaci√≥n del Pedido</span><button class="modal-close" onclick="cerrarPedido()">‚úï</button></div>
            <form onsubmit="realizarPedido(event)">
                <div class="form-group"><label>Nombre:</label><input type="text" id="nombre-pedido" required></div>
                <div class="form-group"><label>Direcci√≥n:</label><input type="text" id="direccion-pedido" required></div>
                <div class="form-group"><label>Tel√©fono:</label><input type="tel" id="telefono-pedido" required></div>
                <div class="form-group">
                    <label>Tipo de Entrega:</label>
                    <select id="tipo-entrega" required>
                        <option value="domicilio">üöö Casa</option>
                        <option value="tienda">üè™ Tienda</option>
                    </select>
                </div>
                <div class="form-group"><label>Notas:</label><textarea id="notas-pedido" rows="3"></textarea></div>
                <div class="precio-box">
                    <div class="precio-fila"><span>Subtotal:</span><span id="subtotal-pedido">$0</span></div>
                    <div class="precio-fila"><span>Descuento:</span><span id="descuento-pedido">$0</span></div>
                    <div class="precio-fila precio-total"><span>TOTAL:</span><span id="total-pedido">$0</span></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarPedido()">Cancelar</button>
                    <button type="submit" class="btn btn-success">‚úÖ Realizar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- DASHBOARD VENDEDOR -->
    <div id="vendedor-dashboard" class="content">
        <div class="container">
            <div class="dashboard">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Panel de Vendedor</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="abrirCambiarPassword()">üîê Cambiar Contrase√±a</button>
                        <button class="btn logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
                    </div>
                </div>
                <div class="menu">
                    <button class="menu-item" onclick="showVendedorSection('clientes')">üë• Mis Clientes</button>
                    <button class="menu-item" onclick="showVendedorSection('agregar-cliente')">‚ûï Agregar Cliente</button>
                    <button class="menu-item" onclick="showVendedorSection('pedidos')">üì¶ Pedidos Recibidos</button>
                    <button class="menu-item" onclick="showVendedorSection('descuentos')">üè∑Ô∏è Proponer Descuento</button>
                    <button class="menu-item" onclick="showVendedorSection('notas')">üìù Mis Notas</button>
                    <button class="menu-item" onclick="showVendedorSection('facturas')">üßæ Mis Facturas</button>
                    <button class="menu-item" onclick="showVendedorSection('mensajes')">üí¨ Mensajes</button>
                    <button class="menu-item" onclick="showVendedorSection('historial')">üìã Historial</button>
                    <!-- BOT√ìN DE PRODUCCI√ìN SOLO PARA VENDEDORES QUE SON T√âCNICOS -->
                    <button class="menu-item produccion" id="btn-produccion-vendedor" style="display:none;" onclick="showVendedorSection('produccion')">üè≠ Mi Producci√≥n</button>
                </div>
                <div id="vendedor-content" style="background: white; padding: 2rem; border-radius: 12px; margin-top: 2rem;"></div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD T√âCNICO (NUEVO) -->
    <div id="tecnico-dashboard" class="content">
        <div class="container">
            <div class="dashboard">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>üè≠ Panel de T√©cnico en Rotomoldeo</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="abrirCambiarPassword()">üîê Cambiar Contrase√±a</button>
                        <button class="btn logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
                    </div>
                </div>
                <div class="menu">
                    <button class="menu-item produccion" onclick="showTecnicoSection('registrar')">üìù Registrar Producci√≥n</button>
                    <button class="menu-item produccion" onclick="showTecnicoSection('mi-produccion')">üìä Mi Producci√≥n</button>
                    <button class="menu-item" onclick="showTecnicoSection('historial')">üìã Historial</button>
                </div>
                <div id="tecnico-content" style="background: white; padding: 2rem; border-radius: 12px; margin-top: 2rem;"></div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD ADMIN -->
    <div id="admin-dashboard" class="content">
        <div class="container">
            <div class="dashboard">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Panel de Administrador</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="abrirCambiarPassword()">üîê Cambiar Contrase√±a</button>
                        <button class="btn logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
                    </div>
                </div>
                <div class="menu">
                    <button class="menu-item" onclick="showAdminSection('productos')">üì¶ Gesti√≥n de Productos</button>
                    <button class="menu-item" onclick="showAdminSection('descuentos')">‚úÖ Solicitudes Descuentos</button>
                    <button class="menu-item" onclick="showAdminSection('descuento-directo')">üéÅ Otorgar Descuento</button>
                    <button class="menu-item" onclick="showAdminSection('ventas')">üìä Ver Ventas</button>
                    <button class="menu-item" onclick="showAdminSection('pedidos')">üì¶ Todos los Pedidos</button>
                    <button class="menu-item" onclick="showAdminSection('clientes')">üë• Ver Clientes</button>
                    <button class="menu-item" onclick="showAdminSection('reportes')">üìà Reportes Ventas</button>
                    <button class="menu-item produccion" onclick="showAdminSection('produccion')">üè≠ Ver Producci√≥n</button>
                    <button class="menu-item produccion" onclick="showAdminSection('reportes-produccion')">üìä Reportes Producci√≥n</button>
                    <button class="menu-item" onclick="showAdminSection('mensajes')">üí¨ Mensajes</button>
                    <button class="menu-item" onclick="showAdminSection('agregar-cliente')">‚ûï Agregar Cliente</button>
                </div>
                <div id="admin-content" style="background: white; padding: 2rem; border-radius: 12px; margin-top: 2rem;"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-section">
            <strong>TINACOS PLASTINOVA S.A. de C.V.</strong><br>
            üíß Soluciones Premium de Almacenamiento de Agua üíß
        </div>
        <div class="footer-section">
            üìç Carretera Zapata-Zacatepec, Col. L√°zaro C√°rdenas, C.P. 62790, Chiconcuac, Morelos<br>
            üìû Tel√©fonos: <a href="tel:7775146927">777 5146927</a> / <a href="tel:7775347617">777 5347617</a> / <a href="tel:5613420821">561 3420821</a> / <a href="tel:7771636393">777 1636393</a><br>
            üìß Correo: <a href="mailto:tinacos-plastinova@outlook.com">tinacos-plastinova@outlook.com</a><br>
            üè¢ RFC: PPU790219S16
        </div>
        <div class="footer-section">
            ‚è∞ Horario de atenci√≥n: Lunes a S√°bado de 9:00 a 18:00 hrs
        </div>
        <div style="margin-top: 1rem; color: #eeeeee; font-size: 0.9rem;">
            ¬© 2025 TINACOS PLASTINOVA. Todos los derechos reservados.
        </div>
    </footer>

    <script>
// ==================== DATOS DE PRODUCTOS (VENTAS) ====================
const productos = [
    { id: 1, nombre: 'Tambo 235 lt', capacidad: 235, precio: 520, tipo: 'tambo', foto: '', colores: { beige: '#D4A574', blanco: '#FFFFFF', negro: '#000000', azul: '#003B7F', rojo: '#DC2626', verde: '#10B981', naranja: '#F97316', granito: '#808080' } },
    { id: 2, nombre: 'Tinaco 750 lt', capacidad: 750, precio: 1400, tipo: 'tinaco', foto: '', colores: { beige: '#D4A574', blanco: '#FFFFFF', negro: '#000000', rojo: '#DC2626', verde: '#10B981', naranja: '#F97316', caf√©: '#8B4513', granito: '#808080' } },
    { id: 3, nombre: 'Tinaco 1100 lt', capacidad: 1100, precio: 1500, tipo: 'tinaco', foto: '', colores: { beige: '#D4A574', blanco: '#FFFFFF', negro: '#000000', rojo: '#DC2626', verde: '#10B981', naranja: '#F97316', caf√©: '#8B4513', granito: '#808080' } },
    { id: 4, nombre: 'Tinaco 1200 lt', capacidad: 1200, precio: 1600, tipo: 'tinaco', foto: '', colores: { beige: '#D4A574', blanco: '#FFFFFF', negro: '#000000', rojo: '#DC2626', verde: '#10B981', naranja: '#F97316', caf√©: '#8B4513', granito: '#808080' } }
];

// ==================== DATOS DE PRODUCCI√ìN (NUEVOS) ====================
const productosProduccion = [
    { 
        id: 1, 
        nombre: 'Tambo 235 lt', 
        capacidad: 235, 
        colores: ['beige', 'blanco', 'negro', 'rojo', 'azul', 'verde', 'naranja', 'caf√©', 'granito', 'azul con blanco', 'mel√≥n', 'verde con blanco', 'morado', 'oxford', 'terracota']
    },
    { 
        id: 2, 
        nombre: 'Tinaco 750 lt', 
        capacidad: 750, 
        colores: ['beige', 'natural', 'blanco', 'negro', 'rojo', 'azul', 'verde', 'naranja', 'caf√©', 'oxford']
    },
    { 
        id: 3, 
        nombre: 'Tinaco 1100 lt', 
        capacidad: 1100, 
        colores: ['beige', 'natural', 'blanco', 'negro', 'rojo', 'azul', 'verde', 'naranja', 'caf√©', 'oxford']
    },
    { 
        id: 4, 
        nombre: 'Tinaco 1200 lt', 
        capacidad: 1200, 
        colores: ['beige', 'natural', 'blanco', 'negro', 'rojo', 'azul', 'verde', 'naranja', 'caf√©', 'oxford']
    },
    { 
        id: 5, 
        nombre: 'Maceta cuadrada chica', 
        capacidad: 0, 
        colores: ['beige', 'blanco', 'negro', 'rojo', 'azul', 'verde', 'naranja', 'caf√©', 'granito', 'azul con blanco', 'mel√≥n', 'verde con blanco', 'morado', 'oxford', 'terracota']
    },
    { 
        id: 6, 
        nombre: 'Maceta cuadrada grande', 
        capacidad: 0, 
        colores: ['beige', 'blanco', 'negro', 'rojo', 'azul', 'verde', 'naranja', 'caf√©', 'granito', 'azul con blanco', 'mel√≥n', 'verde con blanco', 'morado', 'oxford', 'terracota']
    },
    { 
        id: 7, 
        nombre: 'Cono chico', 
        capacidad: 0, 
        colores: ['beige', 'blanco', 'negro', 'rojo', 'azul', 'verde', 'naranja', 'caf√©', 'granito', 'azul con blanco', 'mel√≥n', 'verde con blanco', 'morado', 'oxford', 'terracota']
    }
];

// ==================== DATOS DE VENDEDORES Y T√âCNICOS ====================
const vendedoresData = [
    { usuario: 'husai.mendez', password: 'Husai2024*', nombre: 'Husai M.', telefono: '777 5146927', rol: 'vendedor', esTecnico: true },
    { usuario: 'pedro.delgado', password: 'Pedro2024*', nombre: 'Pedro D.', telefono: '777 5347617', rol: 'vendedor', esTecnico: true },
    { usuario: 'fernando.ocampo', password: 'Fernando2024*', nombre: 'Fernando O.', telefono: '561 3420821', rol: 'vendedor', esTecnico: true },
    { usuario: 'isidro.gonzalez', password: 'Isidro2024*', nombre: 'Isidro G.', telefono: '777 1636393', rol: 'vendedor', esTecnico: false }
];

const tecnicosData = [
    { usuario: 'pedro.delgado', password: 'Pedro2024*', nombre: 'Pedro Delgado Armenta', rol: 'tecnico' },
    { usuario: 'fernando.ocampo', password: 'Fernando2024*', nombre: 'Fernando Ocampo L√≥pez', rol: 'tecnico' },
    { usuario: 'ivan.martinez', password: 'Ivan2024*', nombre: 'Iv√°n Mart√≠nez', rol: 'tecnico' },
    { usuario: 'husai.mendez', password: 'Husai2024*', nombre: 'Husai M√©ndez', rol: 'tecnico' }
];

const admin = { usuario: 'admin.plastinova', password: 'Admin2024*Plastinova', nombre: 'Administrador', rol: 'admin' };

// ==================== VARIABLES GLOBALES ====================
let usuarioActual = null;
let carrito = [];
let colorSeleccionado = {};
let pedidos = [];
let usuariosRegistrados = [];
let carritoCliente = [];
let clientesGlobal = [];
let notasFacturas = [];
let ventas = [];
let produccionRegistros = []; // Array para registros de producci√≥n

// ==================== FUNCIONES DE NAVEGACI√ìN ====================
function showContent(id) { 
    document.querySelectorAll('.content').forEach(el => el.classList.remove('active')); 
    document.getElementById(id).classList.add('active'); 
}

function backToLanding() { showContent('landing'); }
function showLogin() { 
    showContent('login'); 
    const recordado = localStorage.getItem('usuarioRecordado'); 
    if (recordado) document.getElementById('username').value = recordado; 
}
function showRegister() { showContent('register'); }

// ==================== FUNCIONES DE AUTENTICACI√ìN ====================
function handleRegister(event) { 
    event.preventDefault(); 
    const nombre = document.getElementById('reg-nombre').value; 
    const telefono = document.getElementById('reg-telefono').value; 
    const direccion = document.getElementById('reg-direccion').value; 
    const usuario = document.getElementById('reg-usuario').value; 
    const password = document.getElementById('reg-password').value; 
    const vendedor = document.getElementById('reg-vendedor').value; 
    
    const nuevoCliente = { usuario, password, nombre, telefono, direccion, vendedor, rol: 'comprador' }; 
    usuariosRegistrados.push(nuevoCliente); 
    clientesGlobal.push(nuevoCliente); 
    mostrarNotification('‚úÖ Registro exitoso'); 
    showContent('landing'); 
}

function guestCheckout() { 
    usuarioActual = { nombre: 'Invitado', rol: 'comprador' }; 
    document.getElementById('carrito-btn').style.display = 'flex'; 
    mostrarProductos(); 
}

function handleLogin(event) { 
    event.preventDefault(); 
    const username = document.getElementById('username').value; 
    const password = document.getElementById('password').value; 
    const recordar = document.getElementById('recordar-usuario').checked; 
    
    // VERIFICAR ADMIN
    if (username === admin.usuario && password === admin.password) { 
        usuarioActual = admin; 
        if (recordar) localStorage.setItem('usuarioRecordado', username); 
        updateNavbar(); 
        showContent('admin-dashboard'); 
        mostrarNotification('‚úÖ Bienvenido Administrador'); 
        return;
    } 
    
    // VERIFICAR VENDEDOR
    const v = vendedoresData.find(v => v.usuario === username && v.password === password); 
    if (v) { 
        usuarioActual = {...v}; 
        if (recordar) localStorage.setItem('usuarioRecordado', username); 
        updateNavbar(); 
        
        // Mostrar bot√≥n de producci√≥n si es t√©cnico
        if (v.esTecnico) {
            document.getElementById('btn-produccion-vendedor').style.display = 'block';
        }
        
        showContent('vendedor-dashboard'); 
        mostrarNotification('‚úÖ Bienvenido ' + v.nombre); 
        return;
    } 
    
    // VERIFICAR T√âCNICO (SOLO T√âCNICO, NO VENDEDOR)
    const t = tecnicosData.find(t => t.usuario === username && t.password === password);
    if (t && !vendedoresData.some(v => v.usuario === username)) {
        usuarioActual = {...t};
        if (recordar) localStorage.setItem('usuarioRecordado', username);
        updateNavbar();
        showContent('tecnico-dashboard');
        mostrarNotification('‚úÖ Bienvenido T√©cnico ' + t.nombre);
        return;
    }
    
    // VERIFICAR COMPRADOR
    const u = usuariosRegistrados.find(u => u.usuario === username && u.password === password); 
    if (u) { 
        usuarioActual = u; 
        if (recordar) localStorage.setItem('usuarioRecordado', username); 
        updateNavbar(); 
        document.getElementById('carrito-btn').style.display = 'flex'; 
        mostrarProductos(); 
        mostrarNotification('‚úÖ Bienvenido ' + u.nombre); 
        return;
    } 
    
    mostrarNotification('‚ùå Credenciales incorrectas', true); 
    
    document.getElementById('username').value = ''; 
    document.getElementById('password').value = ''; 
}

function logout() { 
    usuarioActual = null; 
    carrito = []; 
    colorSeleccionado = {}; 
    document.getElementById('carrito-btn').style.display = 'none'; 
    showContent('landing'); 
    updateNavbar(); 
    mostrarNotification('üëã Sesi√≥n cerrada'); 
}

function updateNavbar() { 
    document.getElementById('navbar-user').innerHTML = usuarioActual ? `<span style="color: white;">${usuarioActual.nombre}</span>` : ''; 
}

function abrirCambiarPassword() { document.getElementById('cambiar-password-modal').classList.add('active'); }
function cerrarCambiarPassword() { document.getElementById('cambiar-password-modal').classList.remove('active'); }
function cambiarPassword(event) { 
    event.preventDefault(); 
    const nueva = document.getElementById('pass-nueva').value; 
    const confirmar = document.getElementById('pass-confirmar').value; 
    if (nueva !== confirmar) { mostrarNotification('Las contrase√±as no coinciden', true); return; } 
    if (nueva.length < 6) { mostrarNotification('M√≠nimo 6 caracteres', true); return; } 
    mostrarNotification('‚úÖ Contrase√±a cambiada'); 
    cerrarCambiarPassword(); 
}

// ==================== FUNCIONES DE CAT√ÅLOGO ====================
function mostrarCatalogo() { 
    document.getElementById('titulo-cliente').textContent = 'Cat√°logo de Productos'; 
    document.getElementById('productos-grid').style.display = 'grid'; 
    document.getElementById('historial-container').style.display = 'none'; 
    document.getElementById('notas-container').style.display = 'none'; 
}

function mostrarHistorial() { 
    document.getElementById('titulo-cliente').textContent = 'Mis Pedidos'; 
    document.getElementById('productos-grid').style.display = 'none'; 
    document.getElementById('historial-container').style.display = 'block'; 
    document.getElementById('notas-container').style.display = 'none'; 
    
    const vendedorObj = vendedoresData.find(v => v.nombre === usuarioActual.vendedor); 
    const telefonoVendedor = vendedorObj ? vendedorObj.telefono : 'N/A'; 
    
    document.getElementById('historial-tabla').innerHTML = carritoCliente.length === 0 
        ? '<tr><td colspan="5">No hay pedidos</td></tr>' 
        : carritoCliente.map(p => { 
            const vObj = vendedoresData.find(v => v.nombre === p.vendedor); 
            const tel = vObj ? vObj.telefono : 'N/A'; 
            return `<tr><td>${p.numero}</td><td>$${p.total}</td><td>${p.tipoEntrega === 'domicilio' ? 'üöö' : p.tipoEntrega === 'tienda' ? 'üè™' : 'üì¶'}</td><td>${p.vendedor} | ${tel}</td><td>${p.fecha}</td></tr>`; 
        }).join(''); 
}

function mostrarNotasCliente() { 
    document.getElementById('titulo-cliente').textContent = 'Mis Notas y Facturas'; 
    document.getElementById('productos-grid').style.display = 'none'; 
    document.getElementById('historial-container').style.display = 'none'; 
    document.getElementById('notas-container').style.display = 'block'; 
    
    const misNotas = notasFacturas.filter(n => n.cliente === usuarioActual.nombre); 
    document.getElementById('notas-tabla').innerHTML = misNotas.length === 0 
        ? '<tr><td colspan="5">No hay notas o facturas</td></tr>' 
        : misNotas.map(n => `<tr><td>${n.tipo}</td><td>${n.numero}</td><td>${n.pedido}</td><td>$${n.total}</td><td>${n.fecha}</td></tr>`).join(''); 
}

function mostrarProductos() { 
    const grid = document.getElementById('productos-grid'); 
    grid.innerHTML = productos.map(p => `
        <div class="product-card">
            <div class="product-image" style="background: ${p.foto ? `url(${p.foto})` : `linear-gradient(135deg, #003f7f 0%, #${p.tipo === 'tambo' ? 'F97316' : 'DC2626'} 100%)`}; background-size: cover;">
                <span style="background: rgba(0,0,0,0.5); padding: 1rem; border-radius: 8px;">${p.tipo === 'tambo' ? 'üõ¢Ô∏è' : 'üíß'}</span>
            </div>
            <div class="product-info">
                <div class="product-name">${p.nombre}</div>
                <div class="product-capacity">Capacidad: ${p.capacidad} lt</div>
                <div class="product-price">$${p.precio}</div>
                <div class="color-selector">
                    <div class="color-label">Color:</div>
                    <div class="color-options" id="colores-${p.id}">
                        ${Object.entries(p.colores).map(([nombre, hex]) => 
                            `<button type="button" class="color-btn" style="background-color: ${hex};" title="${nombre}" onclick="selectColor(${p.id}, '${nombre}')" id="color-${p.id}-${nombre}"></button>`
                        ).join('')}
                    </div>
                </div>
                <div class="quantity-selector">
                    <button type="button" class="quantity-btn" onclick="cambiarCantidad(${p.id}, -1)">-</button>
                    <input type="number" class="quantity-input" id="qty-${p.id}" value="1" min="1">
                    <button type="button" class="quantity-btn" onclick="cambiarCantidad(${p.id}, 1)">+</button>
                </div>
                <button type="button" class="btn" style="width: 100%;" onclick="agregarAlCarrito(${p.id})">‚ûï Agregar</button>
            </div>
        </div>
    `).join(''); 
    showContent('comprador-dashboard'); 
}

function selectColor(productId, colorNombre) { 
    colorSeleccionado[productId] = colorNombre; 
    document.querySelectorAll(`#colores-${productId} .color-btn`).forEach(btn => btn.classList.remove('selected')); 
    document.getElementById(`color-${productId}-${colorNombre}`).classList.add('selected'); 
    mostrarNotification('‚úÖ Color: ' + colorNombre); 
}

function cambiarCantidad(productId, delta) { 
    const input = document.getElementById(`qty-${productId}`); 
    let valor = parseInt(input.value) + delta; 
    if (valor < 1) valor = 1; 
    input.value = valor; 
}

function agregarAlCarrito(productId) { 
    const producto = productos.find(p => p.id === productId); 
    const cantidad = parseInt(document.getElementById(`qty-${productId}`).value); 
    const color = colorSeleccionado[productId] || 'blanco'; 
    
    const item = { 
        id: productId + '_' + color + '_' + Date.now(), 
        productoId: productId, 
        producto: producto.nombre, 
        precio: producto.precio, 
        cantidad: cantidad, 
        color: color, 
        subtotal: producto.precio * cantidad 
    }; 
    
    carrito.push(item); 
    document.getElementById('contador').textContent = carrito.length; 
    mostrarNotification(`‚úÖ ${cantidad}x ${producto.nombre}`); 
    document.getElementById(`qty-${productId}`).value = 1; 
    delete colorSeleccionado[productId]; 
}

function abrirCarrito() { 
    const modal = document.getElementById('carrito-modal'); 
    const itemsHTML = carrito.length === 0 
        ? '<p>Carrito vac√≠o</p>' 
        : `<table><thead><tr><th>Producto</th><th>Color</th><th>Cant</th><th>Precio</th><th>Subtotal</th><th></th></tr></thead><tbody>${carrito.map((item, idx) => `<tr><td>${item.producto}</td><td>${item.color}</td><td>${item.cantidad}</td><td>$${item.precio}</td><td>$${item.subtotal}</td><td><button type="button" class="btn btn-secondary btn-small" onclick="eliminarDelCarrito(${idx})">‚ùå</button></td></tr>`).join('')}</tbody></table>`; 
    
    document.getElementById('carrito-items').innerHTML = itemsHTML; 
    const total = carrito.reduce((sum, item) => sum + item.subtotal, 0); 
    document.getElementById('carrito-total').innerHTML = `Total: $${total}`; 
    modal.classList.add('active'); 
}

function cerrarCarrito() { document.getElementById('carrito-modal').classList.remove('active'); }
function eliminarDelCarrito(idx) { 
    carrito.splice(idx, 1); 
    document.getElementById('contador').textContent = carrito.length; 
    abrirCarrito(); 
    mostrarNotification('‚ùå Eliminado'); 
}

function abrirFormularioPedido() { 
    cerrarCarrito(); 
    if (usuarioActual.rol === 'comprador' && usuarioActual.usuario) { 
        const subtotal = carrito.reduce((sum, item) => sum + item.subtotal, 0); 
        document.getElementById('subtotal-cliente').innerHTML = `$${subtotal}`; 
        document.getElementById('total-cliente').innerHTML = `$${subtotal}`; 
        document.getElementById('nombre-mostrar').textContent = usuarioActual.nombre; 
        document.getElementById('direccion-mostrar').textContent = usuarioActual.direccion; 
        document.getElementById('telefono-mostrar').textContent = usuarioActual.telefono || 'N/A'; 
        document.getElementById('pedido-cliente-modal').classList.add('active'); 
    } else { 
        const subtotal = carrito.reduce((sum, item) => sum + item.subtotal, 0); 
        document.getElementById('subtotal-pedido').innerHTML = `$${subtotal}`; 
        document.getElementById('descuento-pedido').innerHTML = `$0`; 
        document.getElementById('total-pedido').innerHTML = `$${subtotal}`; 
        document.getElementById('pedido-modal').classList.add('active'); 
    } 
}

function cerrarPedido() { document.getElementById('pedido-modal').classList.remove('active'); }
function cerrarPedidoCliente() { document.getElementById('pedido-cliente-modal').classList.remove('active'); }

function realizarPedidoCliente(event) { 
    event.preventDefault(); 
    if (carrito.length === 0) { mostrarNotification('Carrito vac√≠o', true); return; } 
    
    const tipoEntrega = document.getElementById('tipo-entrega-cliente').value; 
    const quienRecibe = document.getElementById('quien-recibe').value; 
    const metodoPago = document.getElementById('metodo-pago').value; 
    const total = carrito.reduce((sum, item) => sum + item.subtotal, 0); 
    const numeroPedido = '#' + Math.random().toString(36).substr(2, 9).toUpperCase(); 
    
    const vendedorAleatorio = vendedoresData.find(v => v.nombre === usuarioActual.vendedor) || vendedoresData[0]; 
    
    const pedido = { 
        numero: numeroPedido, 
        nombre: usuarioActual.nombre, 
        direccion: usuarioActual.direccion, 
        telefono: usuarioActual.telefono, 
        tipoEntrega, 
        quienRecibe, 
        metodoPago, 
        items: [...carrito], 
        total, 
        fecha: new Date().toLocaleDateString(), 
        vendedor: vendedorAleatorio.nombre 
    }; 
    
    pedidos.push(pedido); 
    carritoCliente.push(pedido); 
    
    const venta = { 
        vendedor: vendedorAleatorio.nombre, 
        cliente: usuarioActual.nombre, 
        total: total, 
        fecha: new Date().toLocaleDateString() 
    }; 
    ventas.push(venta); 
    
    mostrarNotification(`‚úÖ ¬°Pedido ${numeroPedido}!\nPago: ${metodoPago === 'efectivo' ? 'Efectivo' : 'Transfer'}`); 
    carrito = []; 
    document.getElementById('contador').textContent = 0; 
    cerrarPedidoCliente(); 
    mostrarProductos(); 
}

function realizarPedido(event) { 
    event.preventDefault(); 
    if (carrito.length === 0) { mostrarNotification('Carrito vac√≠o', true); return; } 
    
    const nombre = document.getElementById('nombre-pedido').value; 
    const direccion = document.getElementById('direccion-pedido').value; 
    const telefono = document.getElementById('telefono-pedido').value; 
    const tipoEntrega = document.getElementById('tipo-entrega').value; 
    const total = carrito.reduce((sum, item) => sum + item.subtotal, 0); 
    const numeroPedido = '#' + Math.random().toString(36).substr(2, 9).toUpperCase(); 
    
    const vendedorAleatorio = vendedoresData[Math.floor(Math.random() * vendedoresData.length)]; 
    
    const pedido = { 
        numero: numeroPedido, 
        nombre, 
        direccion, 
        telefono, 
        tipoEntrega, 
        items: [...carrito], 
        total, 
        fecha: new Date().toLocaleDateString(), 
        vendedor: vendedorAleatorio.nombre 
    }; 
    
    pedidos.push(pedido); 
    
    const venta2 = { 
        vendedor: vendedorAleatorio.nombre, 
        cliente: nombre, 
        total: total, 
        fecha: new Date().toLocaleDateString() 
    }; 
    ventas.push(venta2); 
    
    mostrarNotification(`‚úÖ Pedido ${numeroPedido}\nAsignado: ${vendedorAleatorio.nombre}`); 
    carrito = []; 
    document.getElementById('contador').textContent = 0; 
    cerrarPedido(); 
    mostrarProductos(); 
}

// ==================== FUNCIONES DE VENDEDOR ====================
function showVendedorSection(section) { 
    const content = document.getElementById('vendedor-content'); 
    const misClientes = clientesGlobal.filter(c => c.vendedor === usuarioActual.nombre); 
    
    if (section === 'clientes') { 
        content.innerHTML = `<h3 class="section-title">üë• Mis Clientes</h3><div class="table-container"><table><thead><tr><th>Nombre</th><th>Tel√©fono</th><th>Direcci√≥n</th><th>Usuario</th><th>Acciones</th></tr></thead><tbody>${misClientes.length === 0 ? '<tr><td colspan="5">No hay clientes asignados</td></tr>' : misClientes.map((c, idx) => `<tr><td>${c.nombre}</td><td>${c.telefono}</td><td>${c.direccion}</td><td>${c.usuario}</td><td><button type="button" class="btn btn-secondary btn-small" onclick="eliminarClienteVendedor(${idx})">‚ùå</button></td></tr>`).join('')}</tbody></table></div>`; 
    } else if (section === 'agregar-cliente') { 
        content.innerHTML = `<h3 class="section-title">‚ûï Agregar Cliente</h3><form onsubmit="agregarClienteVendedor(event)"><div class="form-group"><label>Nombre:</label><input type="text" id="nombre-cliente-v" required></div><div class="form-group"><label>Tel√©fono:</label><input type="tel" id="tel-cliente-v" required></div><div class="form-group"><label>Direcci√≥n:</label><input type="text" id="dir-cliente-v" required></div><div class="form-group"><label>Google Maps:</label><input type="text" placeholder="https://maps.google.com/..."></div><button type="submit" class="btn">Agregar</button></form>`; 
    } else if (section === 'pedidos') { 
        const misPedidos = pedidos.filter(p => p.vendedor === usuarioActual.nombre); 
        content.innerHTML = `<h3 class="section-title">üì¶ Pedidos Recibidos</h3><div class="table-container"><table><thead><tr><th>Pedido</th><th>Cliente</th><th>Tipo</th><th>Total</th><th>Pago</th><th>Fecha</th></tr></thead><tbody>${misPedidos.length === 0 ? '<tr><td colspan="6">No hay pedidos</td></tr>' : misPedidos.map(p => `<tr><td>${p.numero}</td><td>${p.nombre}</td><td>${p.tipoEntrega === 'domicilio' ? 'üöö' : p.tipoEntrega === 'tienda' ? 'üè™' : 'üì¶'}</td><td>$${p.total}</td><td>${p.metodoPago ? (p.metodoPago === 'efectivo' ? 'üíµ' : 'üí≥') : 'N/A'}</td><td>${p.fecha}</td></tr>`).join('')}</tbody></table></div>`; 
    } else if (section === 'produccion') {
        showProduccionVendedor();
    } else if (section === 'descuentos') { 
        content.innerHTML = `<h3 class="section-title">üè∑Ô∏è Proponer Descuento</h3><form onsubmit="proponerDescuento(event)"><div class="form-group"><label>Cliente:</label><select required><option>Seleccionar</option></select></div><div class="dos-columnas"><div class="form-group"><label>Porcentaje:</label><input type="number" min="1" max="100" required></div><div class="form-group"><label>Tipo:</label><select id="desc-tipo" onchange="actualizarProductos()" required><option value="general">General</option><option value="producto">Por Producto</option></select></div></div><div id="prod-descto" style="display:none;">${productos.map(p => `<div class="form-group"><label>${p.nombre}</label><input type="number" min="0" max="100" placeholder="%"></div>`).join('')}</div><div class="form-group"><label>Justificaci√≥n:</label><textarea required></textarea></div><button type="submit" class="btn">Enviar</button></form>`; 
    } else if (section === 'notas') { 
        content.innerHTML = `<h3 class="section-title">üìù Generar Nota</h3><form onsubmit="generarNotaVendedor(event)"><div class="form-group"><label>Pedido:</label><select id="pedido-nota" required><option>Elegir</option>${pedidos.map(p => `<option value="${p.numero}">${p.numero} - ${p.nombre} - $${p.total}</option>`).join('')}</select></div><div class="form-group"><label>Notas:</label><textarea id="notas-adicionales"></textarea></div><button type="submit" class="btn">üìÑ Generar Nota</button></form>`; 
    } else if (section === 'facturas') { 
        content.innerHTML = `<h3 class="section-title">üßæ Generar Factura</h3><form onsubmit="generarFacturaVendedor(event)"><div class="form-group"><label>Pedido:</label><select id="pedido-factura" required><option>Elegir</option>${pedidos.map(p => `<option value="${p.numero}">${p.numero} - ${p.nombre} - $${p.total}</option>`).join('')}</select></div><div class="form-group"><label>IVA 16%:</label><select id="iva-factura"><option value="no">No</option><option value="si">S√≠</option></select></div><button type="submit" class="btn btn-success">‚úÖ Generar Factura</button></form>`; 
    } else if (section === 'mensajes') { 
        content.innerHTML = `<h3 class="section-title">üí¨ Mensajes</h3><div class="info-box"><p>Coordina con otros vendedores</p></div><div class="form-group"><label>Para:</label><select><option>Husai M.</option><option>Pedro D.</option><option>Fernando O.</option><option>Isidro G.</option></select></div><textarea style="width: 100%; height: 100px; padding: 1rem; border-radius: 8px; border: 2px solid #e2e8f0;"></textarea><button type="button" class="btn" onclick="mostrarNotification('‚úÖ Mensaje enviado')" style="margin-top: 1rem;">Enviar</button>`; 
    } else if (section === 'historial') { 
        content.innerHTML = `<h3 class="section-title">üìã Historial</h3><div class="table-container"><table><thead><tr><th>Pedido</th><th>Cliente</th><th>Total</th><th>Estado</th><th>Fecha</th></tr></thead><tbody>${pedidos.length === 0 ? '<tr><td colspan="5">No hay pedidos</td></tr>' : pedidos.map(p => `<tr><td>${p.numero}</td><td>${p.nombre}</td><td>$${p.total}</td><td>üì¶ Procesando</td><td>${p.fecha}</td></tr>`).join('')}</tbody></table></div>`; 
    } 
}

function actualizarProductos() { 
    document.getElementById('prod-descto').style.display = document.getElementById('desc-tipo').value === 'producto' ? 'block' : 'none'; 
}

function agregarClienteVendedor(event) { 
    event.preventDefault(); 
    const nombre = document.getElementById('nombre-cliente-v').value; 
    const telefono = document.getElementById('tel-cliente-v').value; 
    const direccion = document.getElementById('dir-cliente-v').value; 
    
    const nuevoCliente = { 
        nombre, 
        telefono, 
        direccion, 
        vendedor: usuarioActual.nombre, 
        usuario: 'cliente_' + Date.now(), 
        rol: 'comprador' 
    }; 
    
    clientesGlobal.push(nuevoCliente); 
    usuariosRegistrados.push(nuevoCliente); 
    mostrarNotification('‚úÖ Cliente agregado'); 
    showVendedorSection('clientes'); 
}

function eliminarClienteVendedor(idx) { 
    const misClientes = clientesGlobal.filter(c => c.vendedor === usuarioActual.nombre); 
    const clienteAEliminar = misClientes[idx]; 
    const idxGlobal = clientesGlobal.indexOf(clienteAEliminar); 
    if (idxGlobal > -1) clientesGlobal.splice(idxGlobal, 1); 
    mostrarNotification('‚ùå Cliente eliminado'); 
    showVendedorSection('clientes'); 
}

function proponerDescuento(event) { 
    event.preventDefault(); 
    mostrarNotification('‚úÖ Propuesta enviada'); 
}

function generarNotaVendedor(event) { 
    event.preventDefault(); 
    const numeroPedido = document.getElementById('pedido-nota').value; 
    const pedido = pedidos.find(p => p.numero === numeroPedido); 
    if (!pedido) { mostrarNotification('Pedido no encontrado', true); return; } 
    
    const numeroNota = 'NOTA-' + Math.random().toString(36).substr(2, 6).toUpperCase(); 
    const nota = { 
        tipo: 'Nota', 
        numero: numeroNota, 
        pedido: pedido.numero, 
        cliente: pedido.nombre, 
        total: pedido.total, 
        fecha: new Date().toLocaleDateString(), 
        vendedor: usuarioActual.nombre 
    }; 
    
    notasFacturas.push(nota); 
    mostrarNotification(`‚úÖ Nota ${numeroNota} generada y enviada al cliente`); 
}

function generarFacturaVendedor(event) { 
    event.preventDefault(); 
    const numeroPedido = document.getElementById('pedido-factura').value; 
    const pedido = pedidos.find(p => p.numero === numeroPedido); 
    if (!pedido) { mostrarNotification('Pedido no encontrado', true); return; } 
    
    const numeroFactura = 'FAC-' + Math.random().toString(36).substr(2, 6).toUpperCase(); 
    const iva = document.getElementById('iva-factura').value; 
    
    const factura = { 
        tipo: 'Factura', 
        numero: numeroFactura, 
        pedido: pedido.numero, 
        cliente: pedido.nombre, 
        total: iva === 'si' ? (pedido.total * 1.16) : pedido.total, 
        fecha: new Date().toLocaleDateString(), 
        vendedor: usuarioActual.nombre, 
        iva: iva === 'si' 
    }; 
    
    notasFacturas.push(factura); 
    mostrarNotification(`‚úÖ Factura ${numeroFactura} generada`); 
}

// ==================== FUNCIONES DE PRODUCCI√ìN (CORREGIDAS) ====================
function showProduccionVendedor() {
    const content = document.getElementById('vendedor-content');
    const miProduccion = produccionRegistros.filter(r => r.tecnico === usuarioActual.nombre);
    
    content.innerHTML = `
        <h3 class="section-title">üè≠ Mi Producci√≥n</h3>
        <div class="info-box success">
            <p><strong>Total producido hoy:</strong> ${calcularProduccionDia(usuarioActual.nombre)} unidades</p>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Producto</th>
                        <th>Color</th>
                        <th>Cantidad</th>
                        <th>Defectuosos</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    ${miProduccion.length === 0 
                        ? '<tr><td colspan="6">No hay registros de producci√≥n</td></tr>'
                        : miProduccion.map(r => `
                            <tr>
                                <td>${r.fecha}</td>
                                <td>${r.producto}</td>
                                <td style="text-transform: capitalize;">${r.color}</td>
                                <td><strong>${r.cantidad}</strong></td>
                                <td>${r.defectuosos > 0 ? `<span style="color: #dc2626;">‚ùå ${r.defectuosos}</span>` : '‚úÖ 0'}</td>
                                <td><span style="background: #10b981; color: white; padding: 0.25rem 0.5rem; border-radius: 4px;">‚úÖ Registrado</span></td>
                            </tr>
                        `).join('')
                    }
                </tbody>
            </table>
        </div>
    `;
}

function showTecnicoSection(section) {
    const content = document.getElementById('tecnico-content');
    
    if (section === 'registrar') {
        content.innerHTML = `
            <h3 class="section-title">üìù Registrar Producci√≥n Diaria</h3>
            <form onsubmit="registrarProduccion(event)" style="max-width: 700px;">
                <div class="form-group">
                    <label>Producto:</label>
                    <select id="prod-produccion" required>
                        <option value="">Seleccionar producto...</option>
                        ${productosProduccion.map(p => `<option value="${p.id}">${p.nombre}</option>`).join('')}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Color:</label>
                    <select id="color-produccion" required>
                        <option value="">Primero selecciona un producto</option>
                    </select>
                </div>
                
                <div class="dos-columnas">
                    <div class="form-group">
                        <label>Cantidad Producida:</label>
                        <input type="number" id="cantidad-produccion" min="0" required placeholder="Ej: 50">
                    </div>
                    
                    <div class="form-group">
                        <label>Productos Defectuosos:</label>
                        <input type="number" id="defectuosos-produccion" min="0" value="0" placeholder="Ej: 2">
                    </div>
                </div>
                
                <div class="form-group" id="merma-container" style="display: none;">
                    <label style="color: #dc2626; font-weight: 600;">‚ö†Ô∏è Especifica Material Perdido:</label>
                    <textarea id="material-perdido" rows="3" placeholder="Ej: Polietileno - 5 kg&#10;Pigmento rojo - 1 kg"></textarea>
                </div>
                
                <div class="info-box warning">
                    <p><strong>Nota:</strong> Si hay productos defectuosos, especifica qu√© material se perdi√≥ y cu√°ntos kilos.</p>
                </div>
                
                <button type="submit" class="btn btn-success" style="width: 100%; padding: 1rem; font-size: 1.1rem;">‚úÖ Registrar Producci√≥n</button>
            </form>
        `;
        
        // ‚úÖ AGREGAR LISTENERS DESPU√âS DE CREAR EL HTML
        setTimeout(() => {
            const prodSelect = document.getElementById('prod-produccion');
            const defectuososInput = document.getElementById('defectuosos-produccion');
            const mermaContainer = document.getElementById('merma-container');
            
            if (prodSelect) {
                prodSelect.addEventListener('change', function() {
                    cargarColoresProduccion();
                });
            }
            
            if (defectuososInput) {
                defectuososInput.addEventListener('input', function() {
                    if (mermaContainer) {
                        mermaContainer.style.display = this.value > 0 ? 'block' : 'none';
                    }
                });
            }
        }, 100);
        
    } else if (section === 'mi-produccion') {
        const miProduccion = produccionRegistros.filter(r => r.tecnico === usuarioActual.nombre);
        const totalHoy = calcularProduccionDia(usuarioActual.nombre);
        const totalSemana = calcularProduccionSemana(usuarioActual.nombre);
        const defectuososMes = calcularDefectuososMes(usuarioActual.nombre);
        
        content.innerHTML = `
            <h3 class="section-title">üìä Mi Producci√≥n</h3>
            
            <div class="stats-grid">
                <div class="stat-card success">
                    <h3>Producci√≥n Hoy</h3>
                    <p>${totalHoy}</p>
                </div>
                <div class="stat-card">
                    <h3>Producci√≥n Semanal</h3>
                    <p>${totalSemana}</p>
                </div>
                <div class="stat-card danger">
                    <h3>Defectuosos (Mes)</h3>
                    <p>${defectuososMes}</p>
                </div>
                <div class="stat-card warning">
                    <h3>Eficiencia</h3>
                    <p>${calcularEficiencia(usuarioActual.nombre)}%</p>
                </div>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Producto</th>
                            <th>Color</th>
                            <th>Cantidad</th>
                            <th>Defectuosos</th>
                            <th>Material Perdido</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${miProduccion.length === 0 
                            ? '<tr><td colspan="6">No hay registros de producci√≥n</td></tr>'
                            : miProduccion.slice(-20).reverse().map(r => `
                                <tr>
                                    <td>${r.fecha}</td>
                                    <td>${r.producto}</td>
                                    <td style="text-transform: capitalize;">${r.color}</td>
                                    <td><strong>${r.cantidad}</strong></td>
                                    <td>${r.defectuosos > 0 ? `<span style="color: #dc2626;">‚ùå ${r.defectuosos}</span>` : '‚úÖ 0'}</td>
                                    <td>${r.materialPerdido || '-'}</td>
                                </tr>
                            `).join('')
                        }
                    </tbody>
                </table>
            </div>
        `;
        
    } else if (section === 'historial') {
        const miProduccion = produccionRegistros.filter(r => r.tecnico === usuarioActual.nombre);
        
        content.innerHTML = `
            <h3 class="section-title">üìã Historial Completo</h3>
            <div class="info-box">
                <p><strong>Total registros:</strong> ${miProduccion.length}</p>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Producto</th>
                            <th>Color</th>
                            <th>Cantidad</th>
                            <th>Defectuosos</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${miProduccion.reverse().map(r => `
                            <tr>
                                <td>${r.fecha}</td>
                                <td>${r.hora}</td>
                                <td>${r.producto}</td>
                                <td style="text-transform: capitalize;">${r.color}</td>
                                <td><strong>${r.cantidad}</strong></td>
                                <td>${r.defectuosos > 0 ? `<span style="color: #dc2626;">‚ùå ${r.defectuosos}</span>` : '‚úÖ 0'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }
}

function cargarColoresProduccion() {
    const prodId = parseInt(document.getElementById('prod-produccion').value);
    const colorSelect = document.getElementById('color-produccion');
    
    if (!prodId) {
        colorSelect.innerHTML = '<option value="">Primero selecciona un producto</option>';
        return;
    }
    
    const producto = productosProduccion.find(p => p.id === prodId);
    if (!producto) return;
    
    colorSelect.innerHTML = '<option value="">Seleccionar color...</option>' + 
        producto.colores.map(c => `<option value="${c}" style="text-transform: capitalize;">${c}</option>`).join('');
}

function registrarProduccion(event) {
    event.preventDefault();
    
    const prodId = parseInt(document.getElementById('prod-produccion').value);
    const color = document.getElementById('color-produccion').value;
    const cantidad = parseInt(document.getElementById('cantidad-produccion').value);
    const defectuosos = parseInt(document.getElementById('defectuosos-produccion').value);
    const materialPerdido = document.getElementById('material-perdido') ? document.getElementById('material-perdido').value : '';
    
    const producto = productosProduccion.find(p => p.id === prodId);
    
    const registro = {
        id: Date.now(),
        tecnico: usuarioActual.nombre,
        producto: producto.nombre,
        color: color,
        cantidad: cantidad,
        defectuosos: defectuosos,
        materialPerdido: materialPerdido,
        fecha: new Date().toLocaleDateString('es-MX'),
        hora: new Date().toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' }),
        timestamp: Date.now()
    };
    
    produccionRegistros.push(registro);
    
    mostrarNotification(`‚úÖ Producci√≥n registrada: ${cantidad} ${producto.nombre} (${color})`);
    
    // Limpiar formulario
    event.target.reset();
    document.getElementById('merma-container').style.display = 'none';
    
    // Volver a la vista de producci√≥n
    showTecnicoSection('mi-produccion');
}

// Funciones auxiliares de c√°lculo
function calcularProduccionDia(tecnico) {
    const hoy = new Date().toLocaleDateString('es-MX');
    return produccionRegistros
        .filter(r => r.tecnico === tecnico && r.fecha === hoy)
        .reduce((sum, r) => sum + r.cantidad, 0);
}

function calcularProduccionSemana(tecnico) {
    const hace7Dias = Date.now() - (7 * 24 * 60 * 60 * 1000);
    return produccionRegistros
        .filter(r => r.tecnico === tecnico && r.timestamp >= hace7Dias)
        .reduce((sum, r) => sum + r.cantidad, 0);
}

function calcularDefectuososMes(tecnico) {
    const hace30Dias = Date.now() - (30 * 24 * 60 * 60 * 1000);
    return produccionRegistros
        .filter(r => r.tecnico === tecnico && r.timestamp >= hace30Dias)
        .reduce((sum, r) => sum + r.defectuosos, 0);
}

function calcularEficiencia(tecnico) {
    const hace30Dias = Date.now() - (30 * 24 * 60 * 60 * 1000);
    const registros = produccionRegistros.filter(r => r.tecnico === tecnico && r.timestamp >= hace30Dias);
    
    const totalProducido = registros.reduce((sum, r) => sum + r.cantidad, 0);
    const totalDefectuosos = registros.reduce((sum, r) => sum + r.defectuosos, 0);
    
    if (totalProducido === 0) return 100;
    
    return ((totalProducido - totalDefectuosos) / totalProducido * 100).toFixed(1);
}

// ==================== FUNCIONES DE ADMIN (PRODUCCI√ìN) ====================
function showAdminSection(section) { 
    const content = document.getElementById('admin-content'); 
    
    if (section === 'productos') { 
        content.innerHTML = `<h3 class="section-title">üì¶ Gesti√≥n de Productos</h3><div style="margin-bottom: 2rem;"><button type="button" class="btn btn-success" onclick="abrirAgregarProducto()">‚ûï Agregar Producto</button></div><div class="table-container"><table><thead><tr><th>Producto</th><th>Precio</th><th>Capacidad</th><th>Acciones</th></tr></thead><tbody>${productos.map((p, idx) => `<tr><td>${p.nombre}</td><td>$${p.precio}</td><td>${p.capacidad} lt</td><td><button type="button" class="btn btn-small" onclick="editarPrecio(${p.id})">‚úèÔ∏è</button><button type="button" class="btn btn-secondary btn-small" onclick="eliminarProductoAdmin(${idx})">‚ùå</button></td></tr>`).join('')}</tbody></table></div>`; 
    } else if (section === 'descuentos') { 
        content.innerHTML = `<h3 class="section-title">‚úÖ Descuentos</h3><p>‚úì No hay solicitudes</p>`; 
    } else if (section === 'descuento-directo') { 
        content.innerHTML = `<h3 class="section-title">üéÅ Otorgar Descuento</h3><form onsubmit="aplicarDescuentoDirecto(event)"><div class="form-group"><label>Cliente:</label><select required><option>Seleccionar</option></select></div><div class="form-group"><label>Porcentaje:</label><input type="number" min="0" max="100" required></div><button type="submit" class="btn btn-success">Aplicar</button></form>`; 
    } else if (section === 'ventas') { 
        content.innerHTML = `<h3 class="section-title">üìä Ventas</h3><div class="table-container"><table><thead><tr><th>Vendedor</th><th>Cliente</th><th>Total</th><th>Fecha</th><th>Acciones</th></tr></thead><tbody>${ventas.length === 0 ? '<tr><td colspan="5">No hay ventas registradas</td></tr>' : ventas.map((v, idx) => `<tr><td>${v.vendedor}</td><td>${v.cliente}</td><td>$${v.total}</td><td>${v.fecha}</td><td><button type="button" class="btn btn-secondary btn-small" onclick="eliminarVenta(${idx})">‚ùå</button></td></tr>`).join('')}</tbody></table></div>`; 
    } else if (section === 'pedidos') { 
        content.innerHTML = `<h3 class="section-title">üì¶ Todos los Pedidos</h3><div class="table-container"><table><thead><tr><th>Pedido</th><th>Cliente</th><th>Total</th><th>Vendedor</th><th>Pago</th><th>Fecha</th><th>Acciones</th></tr></thead><tbody>${pedidos.length === 0 ? '<tr><td colspan="7">No hay pedidos</td></tr>' : pedidos.map((p, idx) => `<tr><td>${p.numero}</td><td>${p.nombre}</td><td>$${p.total}</td><td>${p.vendedor}</td><td>${p.metodoPago ? (p.metodoPago === 'efectivo' ? 'üíµ' : 'üí≥') : 'N/A'}</td><td>${p.fecha}</td><td><button type="button" class="btn btn-secondary btn-small" onclick="eliminarPedidoAdmin(${idx})">‚ùå</button></td></tr>`).join('')}</tbody></table></div>`; 
    } else if (section === 'clientes') { 
        content.innerHTML = `<h3 class="section-title">üë• Clientes Registrados</h3><div class="table-container"><table><thead><tr><th>Nombre</th><th>Tel√©fono</th><th>Direcci√≥n</th><th>Vendedor</th><th>Acciones</th></tr></thead><tbody>${clientesGlobal.length === 0 ? '<tr><td colspan="5">No hay clientes</td></tr>' : clientesGlobal.map((c, idx) => `<tr><td>${c.nombre}</td><td>${c.telefono || 'N/A'}</td><td>${c.direccion || 'N/A'}</td><td>${c.vendedor || 'N/A'}</td><td><button type="button" class="btn btn-secondary btn-small" onclick="eliminarClienteAdmin(${idx})">‚ùå</button></td></tr>`).join('')}</tbody></table></div>`; 
    } else if (section === 'reportes') { 
        const totalVentas = pedidos.reduce((s, p) => s + p.total, 0); 
        content.innerHTML = `<h3 class="section-title">üìà Reportes de Ventas</h3><div class="info-box"><p><strong>Total Ventas:</strong> $${totalVentas}</p><p><strong>Pedidos:</strong> ${pedidos.length}</p><p><strong>Promedio:</strong> $${pedidos.length > 0 ? (totalVentas / pedidos.length).toFixed(2) : 0}</p></div><div style="margin-top: 2rem;"><button type="button" class="btn" onclick="descargarReportePDF()">üìÑ PDF</button><button type="button" class="btn btn-secondary" onclick="descargarReporteExcel()">üìä Excel</button></div>`; 
    } else if (section === 'produccion') {
        showAdminProduccion();
    } else if (section === 'reportes-produccion') {
        showAdminReportesProduccion();
    } else if (section === 'mensajes') { 
        content.innerHTML = `<h3 class="section-title">üí¨ Mensajes</h3><div class="info-box"><p>Comunicaci√≥n entre vendedores</p></div>`; 
    } else if (section === 'agregar-cliente') { 
        content.innerHTML = `<h3 class="section-title">‚ûï Agregar Cliente</h3><form onsubmit="agregarClienteAdmin(event)"><div class="form-group"><label>Nombre:</label><input type="text" id="nombre-cliente-admin" required></div><div class="form-group"><label>Tel√©fono:</label><input type="tel" id="tel-cliente-admin" required></div><div class="form-group"><label>Direcci√≥n:</label><input type="text" id="dir-cliente-admin" required></div><div class="form-group"><label>Vendedor:</label><select id="vendedor-cliente-admin" required><option value="">Elegir...</option><option>Husai M.</option><option>Pedro D.</option><option>Fernando O.</option><option>Isidro G.</option></select></div><button type="submit" class="btn btn-success">Agregar</button></form>`; 
    } 
}

function showAdminProduccion() {
    const content = document.getElementById('admin-content');
    
    // Calcular estad√≠sticas por t√©cnico
    const tecnicos = ['Pedro Delgado Armenta', 'Fernando Ocampo L√≥pez', 'Iv√°n Mart√≠nez', 'Husai M√©ndez'];
    const estadisticas = tecnicos.map(tec => {
        const produccion = produccionRegistros.filter(r => r.tecnico === tec);
        const totalProducido = produccion.reduce((sum, r) => sum + r.cantidad, 0);
        const totalDefectuosos = produccion.reduce((sum, r) => sum + r.defectuosos, 0);
        const eficiencia = totalProducido > 0 ? ((totalProducido - totalDefectuosos) / totalProducido * 100).toFixed(1) : 100;
        
        return { tecnico: tec, total: totalProducido, defectuosos: totalDefectuosos, eficiencia };
    });
    
    const totalGeneral = produccionRegistros.reduce((sum, r) => sum + r.cantidad, 0);
    const defectuososGeneral = produccionRegistros.reduce((sum, r) => sum + r.defectuosos, 0);
    
    content.innerHTML = `
        <h3 class="section-title">üè≠ Control de Producci√≥n</h3>
        
        <!-- ‚úÖ BOTONES DE ELIMINACI√ìN -->
        <div class="delete-actions">
            <strong style="width: 100%; color: #dc2626;">‚ö†Ô∏è ELIMINAR REGISTROS DE PRODUCCI√ìN:</strong>
            <button type="button" class="btn btn-danger btn-small" onclick="eliminarProduccionDia()">‚ùå Eliminar Hoy</button>
            <button type="button" class="btn btn-danger btn-small" onclick="eliminarProduccionSemana()">‚ùå Eliminar Semana</button>
            <button type="button" class="btn btn-danger btn-small" onclick="eliminarProduccionMes()">‚ùå Eliminar Mes</button>
            <button type="button" class="btn btn-danger" onclick="eliminarTodasProduccion()">‚ùå ELIMINAR TODO</button>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card success">
                <h3>Producci√≥n Total</h3>
                <p>${totalGeneral}</p>
            </div>
            <div class="stat-card danger">
                <h3>Defectuosos</h3>
                <p>${defectuososGeneral}</p>
            </div>
            <div class="stat-card warning">
                <h3>Eficiencia General</h3>
                <p>${totalGeneral > 0 ? ((totalGeneral - defectuososGeneral) / totalGeneral * 100).toFixed(1) : 100}%</p>
            </div>
            <div class="stat-card">
                <h3>T√©cnicos Activos</h3>
                <p>${estadisticas.filter(e => e.total > 0).length}</p>
            </div>
        </div>
        
        <h4 style="color: #003f7f; font-size: 1.3rem; margin: 2rem 0 1rem 0;">üìä Producci√≥n por T√©cnico</h4>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>T√©cnico</th>
                        <th>Total Producido</th>
                        <th>Defectuosos</th>
                        <th>Eficiencia</th>
                    </tr>
                </thead>
                <tbody>
                    ${estadisticas.map(e => `
                        <tr>
                            <td><strong>${e.tecnico}</strong></td>
                            <td><strong>${e.total}</strong></td>
                            <td>${e.defectuosos > 0 ? `<span style="color: #dc2626;">‚ùå ${e.defectuosos}</span>` : '‚úÖ 0'}</td>
                            <td><span style="background: ${e.eficiencia >= 95 ? '#10b981' : e.eficiencia >= 90 ? '#f59e0b' : '#dc2626'}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px;">${e.eficiencia}%</span></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
        
        <h4 style="color: #003f7f; font-size: 1.3rem; margin: 2rem 0 1rem 0;">üìã Registros Recientes</h4>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>T√©cnico</th>
                        <th>Producto</th>
                        <th>Color</th>
                        <th>Cantidad</th>
                        <th>Defectuosos</th>
                        <th>Material Perdido</th>
                    </tr>
                </thead>
                <tbody>
                    ${produccionRegistros.length === 0 
                        ? '<tr><td colspan="7">No hay registros de producci√≥n</td></tr>'
                        : produccionRegistros.slice(-30).reverse().map(r => `
                            <tr>
                                <td>${r.fecha} ${r.hora}</td>
                                <td>${r.tecnico}</td>
                                <td>${r.producto}</td>
                                <td style="text-transform: capitalize;">${r.color}</td>
                                <td><strong>${r.cantidad}</strong></td>
                                <td>${r.defectuosos > 0 ? `<span style="color: #dc2626;">‚ùå ${r.defectuosos}</span>` : '‚úÖ 0'}</td>
                                <td>${r.materialPerdido ? `<span style="color: #dc2626; font-size: 0.85rem;">${r.materialPerdido}</span>` : '-'}</td>
                            </tr>
                        `).join('')
                    }
                </tbody>
            </table>
        </div>
    `;
}

function showAdminReportesProduccion() {
    const content = document.getElementById('admin-content');
    
    const totalProducido = produccionRegistros.reduce((sum, r) => sum + r.cantidad, 0);
    const totalDefectuosos = produccionRegistros.reduce((sum, r) => sum + r.defectuosos, 0);
    const eficienciaGeneral = totalProducido > 0 ? ((totalProducido - totalDefectuosos) / totalProducido * 100).toFixed(1) : 100;
    
    content.innerHTML = `
        <h3 class="section-title">üìä Reportes de Producci√≥n</h3>
        
        <div class="stats-grid">
            <div class="stat-card success">
                <h3>Total Producido</h3>
                <p>${totalProducido}</p>
            </div>
            <div class="stat-card danger">
                <h3>Total Defectuosos</h3>
                <p>${totalDefectuosos}</p>
            </div>
            <div class="stat-card warning">
                <h3>Eficiencia General</h3>
                <p>${eficienciaGeneral}%</p>
            </div>
            <div class="stat-card">
                <h3>Registros Totales</h3>
                <p>${produccionRegistros.length}</p>
            </div>
        </div>
        
        <div class="info-box">
            <p><strong>Per√≠odo:</strong> Todos los registros</p>
            <p><strong>T√©cnicos:</strong> 4 activos</p>
        </div>
        
        <div style="margin-top: 2rem;">
            <button type="button" class="btn btn-warning" onclick="descargarReporteProduccionPDF()" style="margin-right: 1rem;">üìÑ Reporte PDF</button>
            <button type="button" class="btn btn-warning" onclick="descargarReporteProduccionExcelSemanal()" style="margin-right: 1rem;">üìä Excel Semanal</button>
            <button type="button" class="btn btn-warning" onclick="descargarReporteProduccionExcelMensual()">üìä Excel Mensual</button>
        </div>
    `;
}

// ‚úÖ FUNCIONES PARA ELIMINAR PRODUCCI√ìN
function eliminarProduccionDia() {
    if (!confirm('‚ö†Ô∏è ¬øEliminar registros de HOY?\n\nEsta acci√≥n no se puede deshacer.')) return;
    
    const hoy = new Date().toLocaleDateString('es-MX');
    const cantidad = produccionRegistros.filter(r => r.fecha === hoy).length;
    produccionRegistros = produccionRegistros.filter(r => r.fecha !== hoy);
    
    mostrarNotification(`‚ùå Eliminados ${cantidad} registros de hoy`);
    showAdminSection('produccion');
}

function eliminarProduccionSemana() {
    if (!confirm('‚ö†Ô∏è ¬øEliminar registros de la √öLTIMA SEMANA?\n\nEsta acci√≥n no se puede deshacer.')) return;
    
    const hace7Dias = Date.now() - (7 * 24 * 60 * 60 * 1000);
    const cantidad = produccionRegistros.filter(r => r.timestamp >= hace7Dias).length;
    produccionRegistros = produccionRegistros.filter(r => r.timestamp < hace7Dias);
    
    mostrarNotification(`‚ùå Eliminados ${cantidad} registros de la semana`);
    showAdminSection('produccion');
}

function eliminarProduccionMes() {
    if (!confirm('‚ö†Ô∏è ¬øEliminar registros del √öLTIMO MES?\n\nEsta acci√≥n no se puede deshacer.')) return;
    
    const hace30Dias = Date.now() - (30 * 24 * 60 * 60 * 1000);
    const cantidad = produccionRegistros.filter(r => r.timestamp >= hace30Dias).length;
    produccionRegistros = produccionRegistros.filter(r => r.timestamp < hace30Dias);
    
    mostrarNotification(`‚ùå Eliminados ${cantidad} registros del mes`);
    showAdminSection('produccion');
}

function eliminarTodasProduccion() {
    if (!confirm('üö® ¬øELIMINAR TODOS LOS REGISTROS DE PRODUCCI√ìN?\n\nEsta acci√≥n es IRREVERSIBLE.')) return;
    if (!confirm('üö® CONFIRMACI√ìN FINAL\n\n¬øEst√°s SEGURO de eliminar TODOS los registros?')) return;
    
    const cantidad = produccionRegistros.length;
    produccionRegistros = [];
    
    mostrarNotification(`‚ùå ELIMINADOS ${cantidad} registros`);
    showAdminSection('produccion');
}

function abrirAgregarProducto() { 
    const nombre = prompt('Nombre:'); 
    if (!nombre) return; 
    const capacidad = prompt('Capacidad (lt):'); 
    if (!capacidad) return; 
    const precio = prompt('Precio:'); 
    if (!precio) return; 
    const foto = prompt('URL foto (opcional):'); 
    
    const nuevoProducto = { 
        id: productos.length + 1, 
        nombre, 
        capacidad: parseInt(capacidad), 
        precio: parseFloat(precio), 
        tipo: 'tinaco', 
        foto: foto || '', 
        colores: { blanco: '#FFFFFF', beige: '#D4A574', negro: '#000000' } 
    }; 
    
    productos.push(nuevoProducto); 
    mostrarNotification('‚úÖ Producto agregado'); 
    showAdminSection('productos'); 
}

function editarPrecio(id) { 
    const p = productos.find(x => x.id === id); 
    const nuevo = prompt('Nuevo precio:', p.precio); 
    if (nuevo && !isNaN(nuevo)) { 
        p.precio = parseFloat(nuevo); 
        mostrarNotification('‚úÖ Precio actualizado'); 
        showAdminSection('productos'); 
    } 
}

function eliminarProductoAdmin(idx) { 
    productos.splice(idx, 1); 
    mostrarNotification('‚ùå Producto eliminado'); 
    showAdminSection('productos'); 
}

function eliminarPedidoAdmin(idx) { 
    pedidos.splice(idx, 1); 
    mostrarNotification('‚ùå Pedido eliminado'); 
    showAdminSection('pedidos'); 
}

function eliminarClienteAdmin(idx) { 
    clientesGlobal.splice(idx, 1); 
    mostrarNotification('‚ùå Cliente eliminado'); 
    showAdminSection('clientes'); 
}

function eliminarVenta(idx) { 
    if (idx >= 0 && idx < ventas.length) { 
        ventas.splice(idx, 1); 
        mostrarNotification('‚ùå Venta eliminada'); 
        showAdminSection('ventas'); 
    } 
}

function aplicarDescuentoDirecto(event) { 
    event.preventDefault(); 
    mostrarNotification('‚úÖ Descuento aplicado'); 
}

function agregarClienteAdmin(event) { 
    event.preventDefault(); 
    const nombre = document.getElementById('nombre-cliente-admin').value; 
    const telefono = document.getElementById('tel-cliente-admin').value; 
    const direccion = document.getElementById('dir-cliente-admin').value; 
    const vendedor = document.getElementById('vendedor-cliente-admin').value; 
    
    const nuevoCliente = { 
        nombre, 
        telefono, 
        direccion, 
        vendedor, 
        usuario: 'cliente_' + Date.now(), 
        rol: 'comprador' 
    }; 
    
    clientesGlobal.push(nuevoCliente); 
    usuariosRegistrados.push(nuevoCliente); 
    mostrarNotification('‚úÖ Cliente agregado'); 
    showAdminSection('clientes'); 
}

// ==================== REPORTES PDF VENTAS ====================
function descargarReportePDF() {
    if (typeof window.jspdf === 'undefined') {
        alert('‚ö†Ô∏è ERROR: Librer√≠a jsPDF no cargada.\n\nVerifica tu conexi√≥n a internet y recarga la p√°gina.');
        return;
    }

    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        let y = 20;
        
        // ENCABEZADO
        doc.setFontSize(18);
        doc.setFont('helvetica', 'bold');
        doc.text('TINACOS PLASTINOVA S.A. de C.V.', 105, y, { align: 'center' });
        y += 10;
        
        doc.setFontSize(14);
        doc.text('REPORTE DE VENTAS', 105, y, { align: 'center' });
        y += 15;
        
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.text(`Fecha: ${new Date().toLocaleDateString('es-MX')}`, 14, y);
        y += 10;
        
        // RESUMEN
        const totalVentas = pedidos.reduce((sum, p) => sum + p.total, 0);
        const promedio = pedidos.length > 0 ? (totalVentas / pedidos.length).toFixed(2) : 0;
        
        doc.setFont('helvetica', 'bold');
        doc.text('RESUMEN:', 14, y);
        y += 7;
        doc.setFont('helvetica', 'normal');
        doc.text(`Total Ventas: $${totalVentas}`, 14, y);
        y += 6;
        doc.text(`Pedidos: ${pedidos.length}`, 14, y);
        y += 6;
        doc.text(`Promedio por pedido: $${promedio}`, 14, y);
        y += 12;
        
        // DETALLE DE PEDIDOS
        doc.setFont('helvetica', 'bold');
        doc.text('DETALLE DE PEDIDOS:', 14, y);
        y += 8;
        
        pedidos.forEach((pedido, index) => {
            if (y > 260) {
                doc.addPage();
                y = 20;
            }
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text(`Pedido: ${pedido.numero}`, 14, y);
            y += 6;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.text(`Cliente: ${pedido.nombre}`, 14, y);
            y += 5;
            doc.text(`Vendedor: ${pedido.vendedor}`, 14, y);
            y += 5;
            doc.text(`Total: $${pedido.total}`, 14, y);
            y += 5;
            doc.text(`M√©todo Pago: ${pedido.metodoPago === 'efectivo' ? 'Efectivo' : 'Transferencia'}`, 14, y);
            y += 5;
            doc.text(`Fecha: ${pedido.fecha}`, 14, y);
            y += 10;
            
            if (index < pedidos.length - 1) {
                doc.line(14, y - 2, 196, y - 2);
            }
        });
        
        // PIE DE P√ÅGINA
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.text(`P√°gina ${i} de ${pageCount}`, 105, 285, { align: 'center' });
        }
        
        doc.save(`Reporte_Ventas_Plastinova_${new Date().toLocaleDateString('es-MX').replace(/\//g, '-')}.pdf`);
        mostrarNotification('‚úÖ PDF generado correctamente');
        
    } catch (error) {
        alert('‚ùå Error al generar PDF: ' + error.message);
        console.error(error);
    }
}

// ==================== REPORTES EXCEL VENTAS ====================
function descargarReporteExcel() {
    if (typeof XLSX === 'undefined') {
        alert('‚ö†Ô∏è ERROR: Librer√≠a XLSX no cargada.\n\nVerifica tu conexi√≥n a internet y recarga la p√°gina.');
        return;
    }

    try {
        const data = [];
        
        // T√≠tulo
        data.push(['CONTROL DE VENTAS PLASTINOVA']);
        data.push([]);
        
        // Encabezados
        data.push(['10/10/25', 'VENDEDOR', 'DESCRIPCION', 'CANT.', 'PRECIO UNI', 'SUBTOTAL']);
        
        // Datos de pedidos
        pedidos.forEach(pedido => {
            if (pedido.items && pedido.items.length > 0) {
                pedido.items.forEach(item => {
                    data.push([
                        pedido.fecha,
                        pedido.vendedor,
                        (item.producto + ' ' + item.color).toUpperCase(),
                        item.cantidad.toFixed(2),
                        '$' + item.precio.toFixed(2),
                        '$' + item.subtotal.toFixed(2)
                    ]);
                });
            }
        });
        
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);
        
        ws['!cols'] = [
            { wch: 12 },
            { wch: 20 },
            { wch: 35 },
            { wch: 8 },
            { wch: 13 },
            { wch: 13 }
        ];
        
        ws['!merges'] = [{ s: { r: 0, c: 0 }, e: { r: 0, c: 5 } }];
        
        XLSX.utils.book_append_sheet(wb, ws, 'Ventas');
        XLSX.writeFile(wb, `Control_Ventas_Plastinova_${new Date().toLocaleDateString('es-MX').replace(/\//g, '-')}.xlsx`);
        
        mostrarNotification('‚úÖ Excel generado correctamente');
        
    } catch (error) {
        alert('‚ùå Error al generar Excel: ' + error.message);
        console.error(error);
    }
}

// ==================== REPORTES PDF PRODUCCI√ìN ====================
function descargarReporteProduccionPDF() {
    if (typeof window.jspdf === 'undefined') {
        alert('‚ö†Ô∏è ERROR: Librer√≠a jsPDF no cargada.');
        return;
    }

    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        let y = 20;
        
        // ENCABEZADO
        doc.setFontSize(18);
        doc.setFont('helvetica', 'bold');
        doc.text('TINACOS PLASTINOVA S.A. de C.V.', 105, y, { align: 'center' });
        y += 10;
        
        doc.setFontSize(14);
        doc.text('REPORTE DE PRODUCCION', 105, y, { align: 'center' });
        y += 15;
        
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.text(`Fecha: ${new Date().toLocaleDateString('es-MX')}`, 14, y);
        y += 10;
        
        // RESUMEN
        const totalProducido = produccionRegistros.reduce((sum, r) => sum + r.cantidad, 0);
        const totalDefectuosos = produccionRegistros.reduce((sum, r) => sum + r.defectuosos, 0);
        const eficiencia = totalProducido > 0 ? ((totalProducido - totalDefectuosos) / totalProducido * 100).toFixed(1) : 100;
        
        doc.setFont('helvetica', 'bold');
        doc.text('RESUMEN:', 14, y);
        y += 7;
        doc.setFont('helvetica', 'normal');
        doc.text(`Total Producido: ${totalProducido} unidades`, 14, y);
        y += 6;
        doc.text(`Total Defectuosos: ${totalDefectuosos} unidades`, 14, y);
        y += 6;
        doc.text(`Eficiencia General: ${eficiencia}%`, 14, y);
        y += 6;
        doc.text(`Registros: ${produccionRegistros.length}`, 14, y);
        y += 12;
        
        // DETALLE
        doc.setFont('helvetica', 'bold');
        doc.text('DETALLE DE PRODUCCION:', 14, y);
        y += 8;
        
        produccionRegistros.forEach((registro, index) => {
            if (y > 250) {
                doc.addPage();
                y = 20;
            }
            
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.text(`${registro.fecha} ${registro.hora}`, 14, y);
            y += 6;
            
            doc.setFont('helvetica', 'normal');
            doc.text(`Tecnico: ${registro.tecnico}`, 14, y);
            y += 5;
            doc.text(`Producto: ${registro.producto} (${registro.color})`, 14, y);
            y += 5;
            doc.text(`Cantidad: ${registro.cantidad} | Defectuosos: ${registro.defectuosos}`, 14, y);
            y += 5;
            if (registro.materialPerdido) {
                doc.setFontSize(8);
                doc.text(`Material perdido: ${registro.materialPerdido}`, 14, y);
                y += 5;
                doc.setFontSize(9);
            }
            y += 3;
            
            if (index < produccionRegistros.length - 1) {
                doc.line(14, y, 196, y);
                y += 3;
            }
        });
        
        doc.save(`Reporte_Produccion_${new Date().toLocaleDateString('es-MX').replace(/\//g, '-')}.pdf`);
        mostrarNotification('‚úÖ PDF de producci√≥n generado');
        
    } catch (error) {
        alert('‚ùå Error: ' + error.message);
    }
}

// ==================== REPORTES EXCEL PRODUCCI√ìN ====================
function descargarReporteProduccionExcelSemanal() {
    if (typeof XLSX === 'undefined') {
        alert('‚ö†Ô∏è ERROR: XLSX no cargado');
        return;
    }

    try {
        const hace7Dias = Date.now() - (7 * 24 * 60 * 60 * 1000);
        const registrosSemana = produccionRegistros.filter(r => r.timestamp >= hace7Dias);
        
        const data = [];
        data.push(['REPORTE SEMANAL DE PRODUCCION - PLASTINOVA']);
        data.push([]);
        data.push(['FECHA', 'HORA', 'TECNICO', 'PRODUCTO', 'COLOR', 'CANTIDAD', 'DEFECTUOSOS', 'MATERIAL PERDIDO']);
        
        registrosSemana.forEach(r => {
            data.push([
                r.fecha,
                r.hora,
                r.tecnico,
                r.producto,
                r.color.toUpperCase(),
                r.cantidad,
                r.defectuosos,
                r.materialPerdido || '-'
            ]);
        });
        
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);
        
        ws['!cols'] = [
            { wch: 12 },
            { wch: 8 },
            { wch: 25 },
            { wch: 20 },
            { wch: 20 },
            { wch: 10 },
            { wch: 12 },
            { wch: 30 }
        ];
        
        ws['!merges'] = [{ s: { r: 0, c: 0 }, e: { r: 0, c: 7 } }];
        
        XLSX.utils.book_append_sheet(wb, ws, 'Produccion Semanal');
        XLSX.writeFile(wb, `Produccion_Semanal_${new Date().toLocaleDateString('es-MX').replace(/\//g, '-')}.xlsx`);
        
        mostrarNotification('‚úÖ Excel semanal generado');
        
    } catch (error) {
        alert('‚ùå Error: ' + error.message);
    }
}

function descargarReporteProduccionExcelMensual() {
    if (typeof XLSX === 'undefined') {
        alert('‚ö†Ô∏è ERROR: XLSX no cargado');
        return;
    }

    try {
        const hace30Dias = Date.now() - (30 * 24 * 60 * 60 * 1000);
        const registrosMes = produccionRegistros.filter(r => r.timestamp >= hace30Dias);
        
        const data = [];
        data.push(['REPORTE MENSUAL DE PRODUCCION - PLASTINOVA']);
        data.push([]);
        data.push(['FECHA', 'HORA', 'TECNICO', 'PRODUCTO', 'COLOR', 'CANTIDAD', 'DEFECTUOSOS', 'MATERIAL PERDIDO']);
        
        registrosMes.forEach(r => {
            data.push([
                r.fecha,
                r.hora,
                r.tecnico,
                r.producto,
                r.color.toUpperCase(),
                r.cantidad,
                r.defectuosos,
                r.materialPerdido || '-'
            ]);
        });
        
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);
        
        ws['!cols'] = [
            { wch: 12 },
            { wch: 8 },
            { wch: 25 },
            { wch: 20 },
            { wch: 20 },
            { wch: 10 },
            { wch: 12 },
            { wch: 30 }
        ];
        
        ws['!merges'] = [{ s: { r: 0, c: 0 }, e: { r: 0, c: 7 } }];
        
        XLSX.utils.book_append_sheet(wb, ws, 'Produccion Mensual');
        XLSX.writeFile(wb, `Produccion_Mensual_${new Date().toLocaleDateString('es-MX').replace(/\//g, '-')}.xlsx`);
        
        mostrarNotification('‚úÖ Excel mensual generado');
        
    } catch (error) {
        alert('‚ùå Error: ' + error.message);
    }
}

// ==================== NOTIFICACIONES ====================
function mostrarNotification(msg, esError = false) { 
    const n = document.createElement('div'); 
    n.className = 'notification' + (esError ? ' error' : ''); 
    n.textContent = msg; 
    document.body.appendChild(n); 
    setTimeout(() => n.remove(), 3000); 
}

// ==================== INICIALIZACI√ìN ====================
if ('serviceWorker' in navigator) { 
    navigator.serviceWorker.register('sw.js').catch(() => {}); 
}

updateNavbar();

// Verificar carga de librer√≠as
console.log('jsPDF:', typeof window.jspdf !== 'undefined' ? '‚úÖ Cargado' : '‚ùå NO cargado');
console.log('XLSX:', typeof XLSX !== 'undefined' ? '‚úÖ Cargado' : '‚ùå NO cargado');
console.log('Sistema de Producci√≥n: ‚úÖ Activo');
</script>
</body>
</html>
